<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chapter 12: Usage - The Canadian Style</title>
    <link rel="stylesheet" href="../shared/css/main.css">
    <link rel="stylesheet" href="../shared/css/quiz-styles.css">
</head>
<body>
    <header class="site-header">
        <div class="container">
            <div class="logo-wrapper">
                <img src="../shared/img/maple-logo.svg" alt="Canadian Style Logo" class="logo">
                <h1>The Canadian Style</h1>
            </div>
            <nav class="chapter-nav">
                <a href="../index.html" class="btn btn-secondary">Back to Dashboard</a>
            </nav>
        </div>
    </header>

    <div class="chapter-hero">
        <div class="container">
            <nav class="breadcrumb">
                <a href="../index.html">Home</a> / Chapter 12
            </nav>
            <div class="chapter-meta">
                <div class="chapter-icon">12</div>
                <div>
                    <h1>Usage</h1>
                    <p>Common word choices and expressions in professional writing</p>
                </div>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="chapterProgress" style="width: 0%"></div>
            </div>
        </div>
    </div>

    <nav class="section-tabs" id="sectionNav">
        <div class="container">
            <div class="tabs-list">
                <a href="#introduction" class="tab-link" data-section="introduction">12.01 Introduction</a>
                <a href="#prepositions" class="tab-link" data-section="prepositions">12.02 Prepositions</a>
                <a href="#affect-effect" class="tab-link" data-section="affect-effect">12.03 Affect vs Effect</a>
                <a href="#compose-comprise" class="tab-link" data-section="compose-comprise">12.04 Compose vs Comprise</a>
                <a href="#less-fewer" class="tab-link" data-section="less-fewer">12.05 Less vs Fewer</a>
                <a href="#that-which" class="tab-link" data-section="that-which">12.06 That vs Which</a>
                <a href="#common-errors" class="tab-link" data-section="common-errors">12.07 Common Errors</a>
                <a href="#idioms" class="tab-link" data-section="idioms">12.08 Canadian Idioms</a>
            </div>
        </div>
    </nav>

    <main class="chapter-content">
        <div class="container">
            <!-- Section 12.01: Introduction -->
            <section class="content-section" id="introduction">
                <div class="section-header">
                    <h2>12.01 Introduction</h2>
                </div>
                
                <div class="lesson-content">
                    <p>Correct word usage enhances clarity and credibility in professional writing. 
                    This chapter addresses common usage problems that appear in government documents 
                    and business correspondence.</p>
                    
                    <p>Canadian English follows British conventions in some areas and American in others. 
                    Understanding these patterns helps writers make consistent, appropriate choices.</p>
                    
                    <div class="key-principles">
                        <h3>Key Areas Covered</h3>
                        <ul>
                            <li>Preposition usage and common errors</li>
                            <li>Frequently confused word pairs</li>
                            <li>Canadian spelling and expression preferences</li>
                            <li>Formal vs. informal usage choices</li>
                            <li>Contemporary usage trends</li>
                        </ul>
                    </div>
                </div>
                
                <!-- Quiz Panel -->
                <div class="quiz-panel" id="quiz-introduction"></div>
                
                <div class="section-footer">
                    <button class="btn btn-primary" onclick="completeSection('introduction')">
                        Complete Section → Prepositions
                    </button>
                </div>
            </section>

            <!-- Section 12.02: Prepositions -->
            <section class="content-section" id="prepositions">
                <div class="section-header">
                    <h2>12.02 Prepositions</h2>
                </div>
                
                <div class="lesson-content">
                    <h3>Common Preposition Issues</h3>
                    <p>Prepositions often cause confusion because their usage doesn't always follow logical rules:</p>
                    
                    <div class="replacement-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>Correct</th>
                                    <th>Incorrect</th>
                                    <th>Note</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>different from</td>
                                    <td>different than</td>
                                    <td>Canadian/British preference</td>
                                </tr>
                                <tr>
                                    <td>comply with</td>
                                    <td>comply to</td>
                                    <td>Standard usage</td>
                                </tr>
                                <tr>
                                    <td>responsible for</td>
                                    <td>responsible to (person)</td>
                                    <td>Depends on context</td>
                                </tr>
                                <tr>
                                    <td>independent of</td>
                                    <td>independent from</td>
                                    <td>Canadian preference</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <h3>Subject-Verb Agreement</h3>
                    <div class="examples-grid">
                        <div class="example-card avoid">
                            <h4>❌ Avoid</h4>
                            <p>Neither the manager nor the employees was informed.</p>
                        </div>
                        <div class="example-card prefer">
                            <h4>✅ Prefer</h4>
                            <p>Neither the manager nor the employees were informed.</p>
                            <small>Verb agrees with the closer subject (employees)</small>
                        </div>
                    </div>

                    <h3>Collective Nouns</h3>
                    <p>In Canadian English, collective nouns typically take singular verbs:</p>
                    <ul>
                        <li>The committee <strong>has</strong> decided (not have)</li>
                        <li>The team <strong>is</strong> ready (not are)</li>
                        <li>The government <strong>announces</strong> (not announce)</li>
                    </ul>
                </div>
                
                <!-- Quiz Panel -->
                <div class="quiz-panel" id="quiz-prepositions"></div>
                
                <div class="section-footer">
                    <button class="btn btn-primary" onclick="completeSection('prepositions')">
                        Complete Section → Affect vs Effect
                    </button>
                </div>
            </section>

            <!-- Section 12.03: Affect vs Effect -->
            <section class="content-section" id="affect-effect">
                <div class="section-header">
                    <h2>12.03 Affect vs Effect</h2>
                </div>
                
                <div class="lesson-content">
                    <h3>Basic Distinction</h3>
                    <p><strong>Affect</strong> is usually a verb; <strong>Effect</strong> is usually a noun:</p>
                    
                    <div class="examples-grid">
                        <div class="example-card good">
                            <h4>✅ Affect (Verb)</h4>
                            <p>The new policy will <strong>affect</strong> all employees.<br>
                            Budget cuts <strong>affected</strong> our timeline.<br>
                            How did the change <strong>affect</strong> productivity?</p>
                        </div>
                        <div class="example-card good">
                            <h4>✅ Effect (Noun)</h4>
                            <p>The <strong>effect</strong> of the policy was immediate.<br>
                            What <strong>effect</strong> did the cuts have?<br>
                            The <strong>effects</strong> were far-reaching.</p>
                        </div>
                    </div>
                    
                    <h3>Memory Aids</h3>
                    <div class="rule-section">
                        <h4>Remember:</h4>
                        <ul>
                            <li><strong>A</strong>ffect = <strong>A</strong>ction (verb)</li>
                            <li><strong>E</strong>ffect = <strong>E</strong>nd result (noun)</li>
                            <li><strong>Cause and effect:</strong> The cause affects; the effect follows</li>
                            <li><strong>Test:</strong> Can you substitute "influence"? Use affect</li>
                        </ul>
                    </div>
                    
                    <h3>Less Common Uses</h3>
                    <div class="examples-grid">
                        <div class="example-card good">
                            <h4>✅ Effect as Verb</h4>
                            <p>The new director will <strong>effect</strong> change.<br>
                            (meaning: bring about, cause)</p>
                        </div>
                        <div class="example-card good">
                            <h4>✅ Affect as Noun</h4>
                            <p>The patient showed little <strong>affect</strong>.<br>
                            (psychology term: emotional response)</p>
                        </div>
                    </div>
                </div>
                
                <!-- Quiz Panel -->
                <div class="quiz-panel" id="quiz-affect-effect"></div>
                
                <div class="section-footer">
                    <button class="btn btn-primary" onclick="completeSection('affect-effect')">
                        Complete Section → Compose vs Comprise
                    </button>
                </div>
            </section>

            <!-- Section 12.04: Compose vs Comprise -->
            <section class="content-section" id="compose-comprise">
                <div class="section-header">
                    <h2>12.04 Compose vs Comprise</h2>
                </div>
                
                <div class="lesson-content">
                    <h3>Key Distinction</h3>
                    <p><strong>Compose</strong> means "to make up"; <strong>Comprise</strong> means "to include" or "to consist of":</p>
                    
                    <div class="examples-grid">
                        <div class="example-card good">
                            <h4>✅ Compose</h4>
                            <p>Five departments <strong>compose</strong> the ministry.<br>
                            The report is <strong>composed of</strong> three sections.<br>
                            (Parts make up the whole)</p>
                        </div>
                        <div class="example-card good">
                            <h4>✅ Comprise</h4>
                            <p>The ministry <strong>comprises</strong> five departments.<br>
                            The report <strong>comprises</strong> three sections.<br>
                            (Whole includes the parts)</p>
                        </div>
                    </div>

                    <h3>Common Error</h3>
                    <div class="examples-grid">
                        <div class="example-card avoid">
                            <h4>❌ Avoid</h4>
                            <p>"The committee is <strong>comprised of</strong> five members."</p>
                        </div>
                        <div class="example-card prefer">
                            <h4>✅ Prefer</h4>
                            <p>"The committee <strong>comprises</strong> five members."<br>
                            OR<br>
                            "The committee is <strong>composed of</strong> five members."</p>
                        </div>
                    </div>

                    <h3>Memory Aid</h3>
                    <ul>
                        <li><strong>Comprise = include:</strong> The whole comprises the parts</li>
                        <li><strong>Compose = make up:</strong> The parts compose the whole</li>
                        <li><strong>Never:</strong> "comprised of" is considered incorrect</li>
                    </ul>
                </div>
                
                <!-- Quiz Panel -->
                <div class="quiz-panel" id="quiz-compose-comprise"></div>
                
                <div class="section-footer">
                    <button class="btn btn-primary" onclick="completeSection('compose-comprise')">
                        Complete Section → Less vs Fewer
                    </button>
                </div>
            </section>

            <!-- Section 12.05: Less vs Fewer -->
            <section class="content-section" id="less-fewer">
                <div class="section-header">
                    <h2>12.05 Less vs Fewer</h2>
                </div>
                
                <div class="lesson-content">
                    <h3>Basic Rule</h3>
                    <p>Use <strong>fewer</strong> with countable nouns; use <strong>less</strong> with uncountable nouns:</p>
                    
                    <div class="examples-grid">
                        <div class="example-card good">
                            <h4>✅ Fewer (Countable)</h4>
                            <ul>
                                <li>Fewer people attended</li>
                                <li>Fewer documents required</li>
                                <li>Fewer meetings scheduled</li>
                                <li>Fewer items on the agenda</li>
                            </ul>
                        </div>
                        <div class="example-card good">
                            <h4>✅ Less (Uncountable)</h4>
                            <ul>
                                <li>Less time available</li>
                                <li>Less information needed</li>
                                <li>Less paperwork involved</li>
                                <li>Less money allocated</li>
                            </ul>
                        </div>
                    </div>

                    <h3>Test Method</h3>
                    <p>Ask yourself: "Can I count this?"</p>
                    <ul>
                        <li><strong>Yes, I can count:</strong> Use fewer (1 person, 2 people, 3 people...)</li>
                        <li><strong>No, I can't count:</strong> Use less (water, information, time...)</li>
                    </ul>

                    <h3>Special Cases</h3>
                    <div class="replacement-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>Context</th>
                                    <th>Correct Usage</th>
                                    <th>Explanation</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Distance</td>
                                    <td>less than 10 kilometres</td>
                                    <td>Treated as a unit</td>
                                </tr>
                                <tr>
                                    <td>Time</td>
                                    <td>less than two hours</td>
                                    <td>Treated as a duration</td>
                                </tr>
                                <tr>
                                    <td>Money</td>
                                    <td>less than $100</td>
                                    <td>Treated as an amount</td>
                                </tr>
                                <tr>
                                    <td>Statistics</td>
                                    <td>less than 50%</td>
                                    <td>Percentages use less</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Quiz Panel -->
                <div class="quiz-panel" id="quiz-less-fewer"></div>
                
                <div class="section-footer">
                    <button class="btn btn-primary" onclick="completeSection('less-fewer')">
                        Complete Section → That vs Which
                    </button>
                </div>
            </section>

            <!-- Section 12.06: That vs Which -->
            <section class="content-section" id="that-which">
                <div class="section-header">
                    <h2>12.06 That vs Which</h2>
                </div>
                
                <div class="lesson-content">
                    <h3>Restrictive vs. Non-restrictive</h3>
                    <p>The choice depends on whether the clause is essential to the meaning:</p>
                    
                    <div class="examples-grid">
                        <div class="example-card good">
                            <h4>✅ That (Restrictive)</h4>
                            <p>The report <strong>that</strong> was submitted yesterday needs revision.<br>
                            <small>Essential info: specifies which report</small></p>
                        </div>
                        <div class="example-card good">
                            <h4>✅ Which (Non-restrictive)</h4>
                            <p>The report, <strong>which</strong> was submitted yesterday, needs revision.<br>
                            <small>Extra info: the report is already identified</small></p>
                        </div>
                    </div>

                    <h3>Comma Test</h3>
                    <div class="rule-section">
                        <h4>Simple Rules:</h4>
                        <ul>
                            <li><strong>That:</strong> No commas (restrictive clause)</li>
                            <li><strong>Which:</strong> Set off with commas (non-restrictive clause)</li>
                            <li><strong>Test:</strong> Can you remove the clause without changing the basic meaning?</li>
                            <li><strong>If yes:</strong> Use "which" with commas</li>
                            <li><strong>If no:</strong> Use "that" without commas</li>
                        </ul>
                    </div>

                    <h3>More Examples</h3>
                    <div class="examples-grid">
                        <div class="example-card good">
                            <h4>✅ Restrictive (That)</h4>
                            <ul>
                                <li>Employees that work overtime get paid extra</li>
                                <li>Documents that require signatures are marked</li>
                                <li>The meeting that was cancelled has been rescheduled</li>
                            </ul>
                        </div>
                        <div class="example-card good">
                            <h4>✅ Non-restrictive (Which)</h4>
                            <ul>
                                <li>Our policy, which was updated last year, is effective</li>
                                <li>The budget, which exceeds our projections, was approved</li>
                                <li>This document, which contains sensitive information, is confidential</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <!-- Quiz Panel -->
                <div class="quiz-panel" id="quiz-that-which"></div>
                
                <div class="section-footer">
                    <button class="btn btn-primary" onclick="completeSection('that-which')">
                        Complete Section → Common Errors
                    </button>
                </div>
            </section>

            <!-- Section 12.07: Common Errors -->
            <section class="content-section" id="common-errors">
                <div class="section-header">
                    <h2>12.07 Common Errors</h2>
                </div>
                
                <div class="lesson-content">
                    <h3>Frequently Confused Words</h3>
                    
                    <div class="replacement-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>Word</th>
                                    <th>Meaning</th>
                                    <th>Example</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>Principal</strong></td>
                                    <td>Main, most important</td>
                                    <td>The principal reason for the delay</td>
                                </tr>
                                <tr>
                                    <td><strong>Principle</strong></td>
                                    <td>Fundamental rule or belief</td>
                                    <td>The principle of fairness</td>
                                </tr>
                                <tr>
                                    <td><strong>Complement</strong></td>
                                    <td>To complete or make perfect</td>
                                    <td>The graphics complement the text</td>
                                </tr>
                                <tr>
                                    <td><strong>Compliment</strong></td>
                                    <td>To praise</td>
                                    <td>She complimented his work</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <h3>Between vs Among</h3>
                    <div class="examples-grid">
                        <div class="example-card good">
                            <h4>✅ Between (Two items)</h4>
                            <p>Choose between the two options.<br>
                            The difference between Plan A and Plan B</p>
                        </div>
                        <div class="example-card good">
                            <h4>✅ Among (Three or more)</h4>
                            <p>Choose among the five candidates.<br>
                            Distribute the work among the team members</p>
                        </div>
                    </div>

                    <h3>Data: Singular or Plural?</h3>
                    <p>In formal Canadian writing, treat "data" as plural:</p>
                    <ul>
                        <li>✅ The data <strong>are</strong> conclusive</li>
                        <li>✅ These data <strong>support</strong> our hypothesis</li>
                        <li>❌ The data <strong>is</strong> conclusive (informal only)</li>
                    </ul>

                    <h3>Amount vs Number</h3>
                    <ul>
                        <li><strong>Amount:</strong> Use with uncountable nouns (amount of time, money, work)</li>
                        <li><strong>Number:</strong> Use with countable nouns (number of people, documents, meetings)</li>
                    </ul>
                </div>
                
                <!-- Quiz Panel -->
                <div class="quiz-panel" id="quiz-common-errors"></div>
                
                <div class="section-footer">
                    <button class="btn btn-primary" onclick="completeSection('common-errors')">
                        Complete Section → Canadian Idioms
                    </button>
                </div>
            </section>

            <!-- Section 12.08: Canadian Idioms -->
            <section class="content-section" id="idioms">
                <div class="section-header">
                    <h2>12.08 Canadian Idioms</h2>
                </div>
                
                <div class="lesson-content">
                    <h3>Canadian vs American Expressions</h3>
                    <p>Some expressions have different preferred forms in Canadian English:</p>
                    
                    <div class="replacement-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>Canadian/British</th>
                                    <th>American</th>
                                    <th>Note</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>couldn't care less</td>
                                    <td>could care less</td>
                                    <td>Logical form preferred</td>
                                </tr>
                                <tr>
                                    <td>due to</td>
                                    <td>due to the fact that</td>
                                    <td>More concise</td>
                                </tr>
                                <tr>
                                    <td>on the weekend</td>
                                    <td>on weekends</td>
                                    <td>Canadian preference</td>
                                </tr>
                                <tr>
                                    <td>in hospital</td>
                                    <td>in the hospital</td>
                                    <td>British influence</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <h3>Formal vs Informal Usage</h3>
                    <div class="examples-grid">
                        <div class="example-card prefer">
                            <h4>✅ Formal Writing</h4>
                            <ul>
                                <li>We need to <strong>discuss</strong> this matter</li>
                                <li><strong>Regarding</strong> your request</li>
                                <li>The situation <strong>requires</strong> attention</li>
                                <li>Please <strong>contact</strong> our office</li>
                            </ul>
                        </div>
                        <div class="example-card avoid">
                            <h4>❌ Too Informal</h4>
                            <ul>
                                <li>We need to <strong>talk about</strong> this</li>
                                <li><strong>About</strong> your request</li>
                                <li>This <strong>needs</strong> attention</li>
                                <li>Please <strong>get in touch</strong></li>
                            </ul>
                        </div>
                    </div>

                    <h3>Redundant Expressions to Avoid</h3>
                    <div class="redundancy-list">
                        <ul>
                            <li><strong>Free gift</strong> → gift</li>
                            <li><strong>End result</strong> → result</li>
                            <li><strong>Future plans</strong> → plans</li>
                            <li><strong>Past history</strong> → history</li>
                            <li><strong>First priority</strong> → priority</li>
                            <li><strong>Advance warning</strong> → warning</li>
                        </ul>
                    </div>

                    <h3>Contemporary Usage</h3>
                    <p>Stay current with evolving language while maintaining professional standards:</p>
                    <ul>
                        <li>Gender-neutral language is increasingly expected</li>
                        <li>Plain language principles apply to government writing</li>
                        <li>Technical jargon should be explained for general audiences</li>
                        <li>Cultural sensitivity in expressions and examples</li>
                    </ul>
                </div>
                
                <!-- Quiz Panel -->
                <div class="quiz-panel" id="quiz-idioms"></div>
                
                <div class="section-footer">
                    <button class="btn btn-primary" onclick="completeSection('idioms')">
                        Complete Chapter
                    </button>
                </div>
            </section>
        </div>
    </main>

    <footer class="site-footer">
        <div class="container">
            <p>&copy; 2024 Government of Canada. Based on <em>The Canadian Style</em> (1997 revised edition)</p>
        </div>
    </footer>

    <script type="module">
        import { router } from '../shared/js/router.js';
        import { getProgress, setProgress } from '../shared/js/progress.js';
        import { QuizEngine } from '../shared/js/quiz-engine.js';
        import '../shared/js/components.js';
        
        const CHAPTER_ID = 'ch12';
        const sections = [
            { id: 'introduction', title: '12.01 Introduction' },
            { id: 'prepositions', title: '12.02 Prepositions' },
            { id: 'affect-effect', title: '12.03 Affect vs Effect' },
            { id: 'compose-comprise', title: '12.04 Compose vs Comprise' },
            { id: 'less-fewer', title: '12.05 Less vs Fewer' },
            { id: 'that-which', title: '12.06 That vs Which' },
            { id: 'common-errors', title: '12.07 Common Errors' },
            { id: 'idioms', title: '12.08 Canadian Idioms' }
        ];
        
        // Initialize progress bar
        function updateProgressBar() {
            const progress = getProgress(CHAPTER_ID);
            const chapterProgress = progress || {};
            const completed = Object.values(chapterProgress).filter(Boolean).length;
            const percentage = Math.round((completed / sections.length) * 100);
            
            document.getElementById('chapterProgress').style.width = percentage + '%';
        }
        
        // Mark section as complete
        window.completeSection = function(sectionId) {
            setProgress(CHAPTER_ID, sectionId, true);
            updateProgressBar();
            
            // Navigate to next section
            const currentIndex = sections.findIndex(s => s.id === sectionId);
            if (currentIndex < sections.length - 1) {
                const nextSection = sections[currentIndex + 1];
                showSection(nextSection.id);
                updateActiveTab(document.querySelector(`[data-section="${nextSection.id}"]`));
            } else {
                // Chapter complete
                showCompletionModal();
            }
        };
        
        function showCompletionModal() {
            const modal = document.createElement('div');
            modal.className = 'completion-modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <h3>🎉 Chapter 12 Complete!</h3>
                    <p>You've mastered proper word usage! 
                    Your writing will now be more precise, clear, and professionally Canadian.</p>
                    <div class="modal-actions">
                        <button class="btn btn-outline" onclick="this.closest('.completion-modal').remove()">
                            Stay Here
                        </button>
                        <a href="../index.html" class="btn btn-primary">
                            Back to Dashboard
                        </a>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        // Section navigation - FIXED TO MATCH OTHER CHAPTERS
        function initSectionNavigation() {
            const tabs = document.querySelectorAll('.tab-link');
            tabs.forEach(tab => {
                tab.addEventListener('click', (e) => {
                    e.preventDefault();
                    const sectionId = tab.getAttribute('data-section');
                    
                    // Update active tab
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    // Show/hide sections using CSS classes (not display)
                    const sections = document.querySelectorAll('.content-section');
                    sections.forEach(section => {
                        section.classList.remove('active');
                    });
                    document.getElementById(sectionId).classList.add('active');
                    
                    // Update URL hash
                    window.location.hash = sectionId;
                });
            });
            
            // Handle initial hash
            const hash = window.location.hash.replace('#', '');
            if (hash && document.getElementById(hash)) {
                const tab = document.querySelector(`[data-section="${hash}"]`);
                if (tab) tab.click();
            } else {
                // Default to first section
                tabs[0]?.click();
            }
        }
        
        // Load section quizzes from JSON files
        async function loadSectionQuizzes() {
            try {
                const response = await fetch(`../data/ch12-quiz.json`);
                if (!response.ok) {
                    console.warn('Quiz data not available for chapter 12');
                    return;
                }
                
                const quizData = await response.json();
                
                // Initialize quizzes for sections that have them
                sections.forEach(section => {
                    const sectionQuizData = quizData.sections?.[section.id];
                    if (sectionQuizData && sectionQuizData.questions) {
                        const quizContainer = document.getElementById(`quiz-${section.id}`);
                        if (quizContainer) {
                            const quizEngine = new QuizEngine(sectionQuizData, CHAPTER_ID, section.id);
                            quizEngine.render(quizContainer);
                        }
                    }
                });
            } catch (error) {
                console.warn('Error loading quiz data:', error);
            }
        }
        
        // Initialize page
        initSectionNavigation();
        updateProgressBar();
        loadSectionQuizzes();
        
        // Handle window beforeunload for quiz warnings
        window.addEventListener('beforeunload', (event) => {
            const activeQuiz = document.querySelector('.quiz-engine-container .quiz-in-progress');
            if (activeQuiz) {
                event.preventDefault();
                event.returnValue = 'You have a quiz in progress. Are you sure you want to leave?';
            }
        });
        
        window.addEventListener('progress-changed', updateProgressBar);
    </script>
</body>
</html>
