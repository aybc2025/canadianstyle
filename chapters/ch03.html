<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chapter 3: Spelling - The Canadian Style</title>
    <link rel="stylesheet" href="../shared/css/main.css">
    <link rel="stylesheet" href="../shared/css/quiz-styles.css">
</head>
<body>
    <div class="chapter-container">
        <header class="chapter-header">
            <div class="breadcrumb">
                <a href="../index.html" class="breadcrumb-link">‚Üê Dashboard</a>
                <span class="breadcrumb-separator">/</span>
                <span class="breadcrumb-current">Chapter 3: Spelling</span>
            </div>
            <div class="chapter-progress">
                <div class="progress-bar">
                    <div class="progress-fill" id="chapterProgress"></div>
                </div>
                <span class="progress-text">Progress</span>
            </div>
        </header>

        <nav class="chapter-nav">
            <div class="nav-links">
                <a href="#introduction" class="tab-link active" data-section="introduction">3.01 Introduction</a>
                <a href="#canadian-spelling" class="tab-link" data-section="canadian-spelling">3.02 Canadian Spelling</a>
                <a href="#variants" class="tab-link" data-section="variants">3.03 Variants</a>
                <a href="#word-endings" class="tab-link" data-section="word-endings">3.04 Word Endings</a>
                <a href="#troublesome-words" class="tab-link" data-section="troublesome-words">3.05 Troublesome Words</a>
            </div>
        </nav>

        <main class="chapter-content">
            <!-- Introduction Section -->
            <section class="content-section" id="introduction">
                <div class="section-header">
                    <h2>3.01 Introduction to Canadian Spelling</h2>
                </div>
                
                <div class="content-block">
                    <p>Canadian spelling reflects our unique position between British and American traditions. The Government of Canada follows established conventions that balance historical British usage with practical considerations for North American readers.</p>
                    
                    <div class="key-principles">
                        <h3>Canadian Spelling Principles</h3>
                        <ul>
                            <li>Generally follows British spelling conventions</li>
                            <li>Some American spellings are accepted</li>
                            <li>Consistency within documents is essential</li>
                            <li>Prefer simpler spellings when variants exist</li>
                        </ul>
                    </div>
                    
                    <div class="spelling-overview">
                        <h3>Key Differences</h3>
                        <div class="comparison-grid">
                            <div class="comparison-item">
                                <h4>Canadian/British</h4>
                                <ul>
                                    <li>colour, favour, honour</li>
                                    <li>centre, theatre</li>
                                    <li>defence, licence (noun)</li>
                                    <li>travelling, modelling</li>
                                </ul>
                            </div>
                            <div class="comparison-item">
                                <h4>American</h4>
                                <ul>
                                    <li>color, favor, honor</li>
                                    <li>center, theater</li>
                                    <li>defense, license (noun)</li>
                                    <li>traveling, modeling</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Quiz Panel for Introduction -->
                <div class="quiz-panel" id="quiz-introduction"></div>
                
                <div class="section-footer">
                    <button class="btn btn-primary" onclick="completeSection('introduction')">
                        Mark Complete & Continue
                    </button>
                </div>
            </section>

            <!-- Canadian Spelling Section -->
            <section class="content-section" id="canadian-spelling" style="display: none;">
                <div class="section-header">
                    <h2>3.02 Canadian Spelling Conventions</h2>
                </div>
                
                <div class="content-block">
                    <div class="rule-box">
                        <h4>-our Endings</h4>
                        <p>Canadian spelling retains the British "our" in most words:</p>
                        <ul>
                            <li>colour, flavour, honour, labour</li>
                            <li>behaviour, favour, humour, rigour</li>
                            <li>splendour, vapour, vigour</li>
                        </ul>
                        <p><strong>Exception:</strong> Drop the "u" before suffixes: <em>colourful, favourite, honourable</em></p>
                    </div>
                    
                    <div class="rule-box">
                        <h4>-re Endings</h4>
                        <p>Use "re" endings for:</p>
                        <ul>
                            <li>centre, theatre, fibre</li>
                            <li>litre, metre, kilometre</li>
                            <li>calibre, lustre, sombre</li>
                        </ul>
                        <p><strong>But:</strong> Some words use "er": <em>chapter, disaster, monster</em></p>
                    </div>
                    
                    <div class="examples-grid">
                        <div class="example-item">
                            <h4>Defence vs Defense</h4>
                            <ul>
                                <li><strong>Noun:</strong> defence, offence</li>
                                <li><strong>Verb:</strong> defend, offend</li>
                                <li><strong>Adjective:</strong> defensive, offensive</li>
                            </ul>
                        </div>
                        
                        <div class="example-item">
                            <h4>Licence vs License</h4>
                            <ul>
                                <li><strong>Noun:</strong> driver's licence</li>
                                <li><strong>Verb:</strong> to license</li>
                                <li><strong>Practice:</strong> practice (noun), practise (verb)</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <!-- Quiz Panel for Canadian Spelling -->
                <div class="quiz-panel" id="quiz-canadian-spelling"></div>
                
                <div class="section-footer">
                    <button class="btn btn-primary" onclick="completeSection('canadian-spelling')">
                        Mark Complete & Continue
                    </button>
                </div>
            </section>

            <!-- Variants Section -->
            <section class="content-section" id="variants" style="display: none;">
                <div class="section-header">
                    <h2>3.03 Acceptable Variants</h2>
                </div>
                
                <div class="content-block">
                    <div class="rule-box">
                        <h4>When Both Spellings Are Acceptable</h4>
                        <p>Some words have equally acceptable variants. Choose one and use consistently:</p>
                    </div>
                    
                    <div class="variants-grid">
                        <div class="variant-group">
                            <h4>Technical Terms</h4>
                            <ul>
                                <li>advisor / adviser</li>
                                <li>disk / disc (computing vs. audio)</li>
                                <li>donut / doughnut</li>
                                <li>email / e-mail</li>
                            </ul>
                        </div>
                        
                        <div class="variant-group">
                            <h4>Compound Words</h4>
                            <ul>
                                <li>tomorrow / to-morrow</li>
                                <li>today / to-day</li>
                                <li>website / web site</li>
                                <li>online / on-line</li>
                            </ul>
                        </div>
                        
                        <div class="variant-group">
                            <h4>Numbers</h4>
                            <ul>
                                <li>per cent / percent</li>
                                <li>any one / anyone (depends on meaning)</li>
                                <li>some time / sometime</li>
                            </ul>
                        </div>
                        
                        <div class="variant-group">
                            <h4>Preferred Canadian</h4>
                            <ul>
                                <li><strong>Prefer:</strong> adviser, doughnut</li>
                                <li><strong>Prefer:</strong> email, website, online</li>
                                <li><strong>Prefer:</strong> per cent</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <!-- Quiz Panel for Variants -->
                <div class="quiz-panel" id="quiz-variants"></div>
                
                <div class="section-footer">
                    <button class="btn btn-primary" onclick="completeSection('variants')">
                        Mark Complete & Continue
                    </button>
                </div>
            </section>

            <!-- Word Endings Section -->
            <section class="content-section" id="word-endings" style="display: none;">
                <div class="section-header">
                    <h2>3.04 Word Endings</h2>
                </div>
                
                <div class="content-block">
                    <div class="rule-box">
                        <h4>Double L Rules</h4>
                        <p>Canadian spelling generally doubles the "l" when adding suffixes:</p>
                        <ul>
                            <li>travel ‚Üí travelling, travelled, traveller</li>
                            <li>model ‚Üí modelling, modelled, modeller</li>
                            <li>level ‚Üí levelling, levelled</li>
                            <li>label ‚Üí labelling, labelled</li>
                        </ul>
                    </div>
                    
                    <div class="rule-box">
                        <h4>-ize vs -ise</h4>
                        <p>Canadian spelling generally prefers -ize endings:</p>
                        <ul>
                            <li>organize, recognize, realize</li>
                            <li>modernize, standardize, authorize</li>
                            <li>emphasize, summarize, analyze</li>
                        </ul>
                        <p><strong>But use -ise for:</strong> advertise, exercise, supervise, comprise</p>
                    </div>
                    
                    <div class="examples-grid">
                        <div class="example-item">
                            <h4>-ment Endings</h4>
                            <ul>
                                <li>acknowledgment (not acknowledgement)</li>
                                <li>judgment (not judgement)</li>
                                <li>But: abridgement, arrangement</li>
                            </ul>
                        </div>
                        
                        <div class="example-item">
                            <h4>-ful vs -full</h4>
                            <ul>
                                <li>careful, helpful, wonderful</li>
                                <li>Never use -full ending</li>
                                <li>Exception: "full" as separate word</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <!-- Quiz Panel for Word Endings -->
                <div class="quiz-panel" id="quiz-word-endings"></div>
                
                <div class="section-footer">
                    <button class="btn btn-primary" onclick="completeSection('word-endings')">
                        Mark Complete & Continue
                    </button>
                </div>
            </section>

            <!-- Troublesome Words Section -->
            <section class="content-section" id="troublesome-words" style="display: none;">
                <div class="section-header">
                    <h2>3.05 Troublesome Words</h2>
                </div>
                
                <div class="content-block">
                    <div class="rule-box">
                        <h4>Commonly Confused Spellings</h4>
                        <p>These words are frequently misspelled or confused:</p>
                    </div>
                    
                    <div class="troublesome-grid">
                        <div class="word-group">
                            <h4>A</h4>
                            <ul>
                                <li><strong>affect</strong> (verb) vs <strong>effect</strong> (noun)</li>
                                <li><strong>all right</strong> (not alright)</li>
                                <li><strong>a lot</strong> (not alot)</li>
                                <li><strong>accommodate</strong> (double c, double m)</li>
                            </ul>
                        </div>
                        
                        <div class="word-group">
                            <h4>B-D</h4>
                            <ul>
                                <li><strong>beginning</strong> (double n)</li>
                                <li><strong>calendar</strong> (not calender)</li>
                                <li><strong>committee</strong> (double m, double t)</li>
                                <li><strong>definite</strong> (not definate)</li>
                            </ul>
                        </div>
                        
                        <div class="word-group">
                            <h4>E-L</h4>
                            <ul>
                                <li><strong>embarrass</strong> (double r, double s)</li>
                                <li><strong>guarantee</strong> (not garauntee)</li>
                                <li><strong>independent</strong> (ends in -ent)</li>
                                <li><strong>liaison</strong> (not liason)</li>
                            </ul>
                        </div>
                        
                        <div class="word-group">
                            <h4>M-Z</h4>
                            <ul>
                                <li><strong>maintenance</strong> (not maintainance)</li>
                                <li><strong>occurred</strong> (double r)</li>
                                <li><strong>privilege</strong> (not priviledge)</li>
                                <li><strong>separate</strong> (not seperate)</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="memory-aids">
                        <h4>Memory Aids</h4>
                        <ul>
                            <li><strong>Affect/Effect:</strong> <em>A</em>ffect is an <em>A</em>ction (verb)</li>
                            <li><strong>Separate:</strong> There's <em>a rat</em> in separate</li>
                            <li><strong>Privilege:</strong> It's a <em>privilege</em>, not a <em>priviledge</em></li>
                            <li><strong>Definitely:</strong> <em>Finite</em> is inside <em>definitely</em></li>
                        </ul>
                    </div>
                </div>
                
                <!-- Quiz Panel for Troublesome Words -->
                <div class="quiz-panel" id="quiz-troublesome-words"></div>
                
                <div class="section-footer">
                    <button class="btn btn-primary" onclick="completeSection('troublesome-words')">
                        Mark Complete & Continue
                    </button>
                </div>
            </section>
        </main>
    </div>

    <!-- Include JavaScript modules -->
    <script type="module" src="../shared/js/router.js"></script>
    <script type="module" src="../shared/js/quiz-engine.js"></script>
    <script type="module" src="../shared/js/progress.js"></script>
    <script type="module" src="../shared/js/components.js"></script>

    <script type="module">
        import { router } from '../shared/js/router.js';
        import { getChapterProgress, setProgress } from '../shared/js/progress.js';
        import { QuizEngine } from '../shared/js/quiz-engine.js';
        
        const CHAPTER_ID = 'ch03';
        const sections = [
            { id: 'introduction', title: '3.01 Introduction' },
            { id: 'canadian-spelling', title: '3.02 Canadian Spelling' },
            { id: 'variants', title: '3.03 Variants' },
            { id: 'word-endings', title: '3.04 Word Endings' },
            { id: 'troublesome-words', title: '3.05 Troublesome Words' }
        ];
        
        // Initialize router
        router.init(CHAPTER_ID, sections);
        
        // Update progress bar using correct API
        function updateProgressBar() {
            const chapterProgress = getChapterProgress(CHAPTER_ID);
            const completed = Object.values(chapterProgress).filter(Boolean).length;
            const percentage = Math.round((completed / sections.length) * 100);
            
            const progressBar = document.getElementById('chapterProgress');
            if (progressBar) {
                progressBar.style.width = percentage + '%';
            }
        }
        
        // Mark section as complete
        window.completeSection = function(sectionId) {
            setProgress(CHAPTER_ID, sectionId, true);
            updateProgressBar();
            
            // Navigate to next section
            const currentIndex = sections.findIndex(s => s.id === sectionId);
            if (currentIndex < sections.length - 1) {
                const nextSection = sections[currentIndex + 1];
                router.navigateTo(CHAPTER_ID, nextSection.id);
            } else {
                // Chapter complete
                showCompletionModal();
            }
        };
        
        function showCompletionModal() {
            const modal = document.createElement('div');
            modal.className = 'completion-modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <h3>üéâ Chapter 3 Complete!</h3>
                    <p>You've mastered Canadian spelling rules. Ready for the next chapter?</p>
                    <div class="modal-actions">
                        <button class="btn btn-outline" onclick="this.closest('.completion-modal').remove()">
                            Stay Here
                        </button>
                        <a href="../index.html" class="btn btn-primary">
                            Back to Dashboard
                        </a>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        // Load section quizzes - FIXED VERSION
        async function loadSectionQuizzes() {
            // Sample quiz data - in real implementation, this would come from JSON files
            const quizData = {
                introduction: {
                    title: 'Introduction to Canadian Spelling',
                    questions: [
                        {
                            type: 'mcq',
                            stem: 'Canadian spelling generally follows which tradition?',
                            options: [
                                { label: 'American spelling', correct: false },
                                { label: 'British spelling', correct: true },
                                { label: 'French spelling', correct: false },
                                { label: 'No established convention', correct: false }
                            ],
                            rationale: 'Canadian spelling generally follows British conventions with some American influences.',
                            ref: '¬ß3.01'
                        }
                    ]
                },
                'canadian-spelling': {
                    title: 'Canadian Spelling Conventions',
                    questions: [
                        {
                            type: 'mcq',
                            stem: 'Which is the correct Canadian spelling?',
                            options: [
                                { label: 'color', correct: false },
                                { label: 'colour', correct: true },
                                { label: 'colur', correct: false },
                                { label: 'coler', correct: false }
                            ],
                            rationale: 'Canadian spelling retains the British "our" ending in words like colour.',
                            ref: '¬ß3.02'
                        }
                    ]
                },
                variants: {
                    title: 'Acceptable Variants',
                    questions: [
                        {
                            type: 'mcq',
                            stem: 'Which variant is preferred in Canadian government writing?',
                            options: [
                                { label: 'advisor', correct: false },
                                { label: 'adviser', correct: true },
                                { label: 'both are equally acceptable', correct: false },
                                { label: 'neither is correct', correct: false }
                            ],
                            rationale: 'Canadian government style prefers "adviser" over "advisor".',
                            ref: '¬ß3.03'
                        }
                    ]
                },
                'word-endings': {
                    title: 'Word Endings',
                    questions: [
                        {
                            type: 'mcq',
                            stem: 'How should "travel" + "ing" be spelled in Canadian English?',
                            options: [
                                { label: 'traveling', correct: false },
                                { label: 'travelling', correct: true },
                                { label: 'traviling', correct: false },
                                { label: 'traveleing', correct: false }
                            ],
                            rationale: 'Canadian spelling doubles the "l" when adding suffixes to words ending in "l".',
                            ref: '¬ß3.04'
                        }
                    ]
                },
                'troublesome-words': {
                    title: 'Troublesome Words',
                    questions: [
                        {
                            type: 'fill-blank',
                            stem: 'The new policy will _____ all employees. (influence)',
                            answer: 'affect',
                            rationale: 'Affect is the verb meaning to influence.',
                            ref: '¬ß3.05'
                        }
                    ]
                }
            };
            
            // Initialize quizzes using FIXED API
            for (const section of sections) {
                const quiz = quizData[section.id];
                if (quiz) {
                    const container = document.getElementById(`quiz-${section.id}`);
                    if (container) {
                        // FIXED: Use correct constructor parameters
                        const engine = new QuizEngine(quiz, CHAPTER_ID, section.id);
                        const quizElement = engine.render();
                        container.appendChild(quizElement);
                    }
                }
            }
        }
        
        // Initialize navigation
        function initializeNavigation() {
            document.querySelectorAll('.tab-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const sectionId = link.dataset.section;
                    showSection(sectionId);
                    updateActiveTab(link);
                });
            });
        }
        
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.style.display = 'none';
            });
            
            // Show target section
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.style.display = 'block';
            }
        }
        
        function updateActiveTab(activeLink) {
            document.querySelectorAll('.tab-link').forEach(link => {
                link.classList.remove('active');
            });
            activeLink.classList.add('active');
        }
        
        // Initialize everything
        document.addEventListener('DOMContentLoaded', () => {
            updateProgressBar();
            loadSectionQuizzes();
            initializeNavigation();
            
            if (!window.location.hash) {
                router.navigateTo(CHAPTER_ID, 'introduction');
            }
        });
        
        window.addEventListener('progress-changed', updateProgressBar);
    </script>
</body>
</html>
