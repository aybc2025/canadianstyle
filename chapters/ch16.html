<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chapter 16: Revision & Proofreading - The Canadian Style</title>
    <link rel="stylesheet" href="../shared/css/main.css">
    <link rel="stylesheet" href="../shared/css/quiz-styles.css">
</head>
<body>
    <header class="site-header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <h1><a href="../index.html">The Canadian Style</a></h1>
                </div>
                <nav class="main-nav">
                    <a href="../index.html">Home</a>
                    <a href="../about.html">About</a>
                </nav>
            </div>
        </div>
    </header>

    <nav class="chapter-nav">
        <div class="container">
            <div class="chapter-header">
                <h2>Chapter 16: Revision & Proofreading</h2>
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="chapterProgress"></div>
                    </div>
                    <span class="progress-text">Progress</span>
                </div>
            </div>
            
            <div class="section-tabs" id="sectionNav">
                <a href="#introduction" class="tab-link active" data-section="introduction">16.01 Introduction</a>
                <a href="#revision-process" class="tab-link" data-section="revision-process">16.02 Revision Process</a>
                <a href="#proofreading-techniques" class="tab-link" data-section="proofreading-techniques">16.03 Proofreading</a>
                <a href="#common-errors" class="tab-link" data-section="common-errors">16.04 Common Errors</a>
                <a href="#technical-accuracy" class="tab-link" data-section="technical-accuracy">16.05 Technical Accuracy</a>
                <a href="#master-checklist" class="tab-link" data-section="master-checklist">16.06 Master Checklist</a>
                <a href="#final-review" class="tab-link" data-section="final-review">16.07 Final Review</a>
            </div>
        </div>
    </nav>

    <main class="chapter-content">
        <div class="container">
            <!-- Section 16.01: Introduction -->
            <section class="content-section active" id="introduction">
                <div class="section-header">
                    <h2>16.01 Introduction</h2>
                </div>
                
                <div class="lesson-content">
                    <p>Effective revision and proofreading are essential for producing high-quality government documents. This chapter provides systematic approaches to editing and finalizing your writing.</p>
                    
                    <div class="key-point">
                        <strong>Key Distinction:</strong> Revision focuses on content, organization, and clarity, while proofreading catches surface errors like spelling and punctuation.
                    </div>
                </div>
                
                <div class="section-footer">
                    <button class="btn btn-primary" onclick="completeSection('introduction')">
                        Mark Complete & Continue
                    </button>
                </div>
            </section>

            <!-- Section 16.02: Revision Process -->
            <section class="content-section" id="revision-process">
                <div class="section-header">
                    <h2>16.02 Revision Process</h2>
                </div>
                
                <div class="lesson-content">
                    <p>Revision involves substantial changes to improve content, structure, and effectiveness of your document.</p>
                    
                    <div class="rule-box">
                        <h3>Revision Stages</h3>
                        <ul>
                            <li><strong>Content revision:</strong> Ideas, arguments, evidence, accuracy</li>
                            <li><strong>Structural revision:</strong> Organization, flow, paragraph structure</li>
                            <li><strong>Style revision:</strong> Tone, voice, word choice, sentence variety</li>
                        </ul>
                    </div>
                    
                    <div class="rule-box">
                        <h3>Revision Strategies</h3>
                        <ul>
                            <li><strong>Take breaks:</strong> Distance helps you see problems</li>
                            <li><strong>Read aloud:</strong> Hear awkward phrasing and rhythm</li>
                            <li><strong>Check purpose:</strong> Does each part serve your goal?</li>
                            <li><strong>Consider audience:</strong> Is it appropriate for readers?</li>
                        </ul>
                    </div>
                    
                    <div class="example-box">
                        <h3>Questions to Ask During Revision</h3>
                        <ul>
                            <li>Is the main message clear and compelling?</li>
                            <li>Does the organization support the purpose?</li>
                            <li>Are transitions smooth between ideas?</li>
                            <li>Is the tone appropriate for the audience?</li>
                        </ul>
                    </div>
                </div>
                
                <div class="quiz-panel" id="quiz-revision-process"></div>
                
                <div class="section-footer">
                    <button class="btn btn-primary" onclick="completeSection('revision-process')">
                        Mark Complete & Continue
                    </button>
                </div>
            </section>

            <!-- Section 16.03: Proofreading Techniques -->
            <section class="content-section" id="proofreading-techniques">
                <div class="section-header">
                    <h2>16.03 Proofreading Techniques</h2>
                </div>
                
                <div class="lesson-content">
                    <p>Proofreading catches surface errors that can undermine your document's professionalism and credibility.</p>
                    
                    <div class="rule-box">
                        <h3>Proofreading Methods</h3>
                        <ul>
                            <li><strong>Read backwards:</strong> Start from the end to focus on spelling</li>
                            <li><strong>Use a ruler:</strong> Cover text below the line you're reading</li>
                            <li><strong>Print it out:</strong> Screen reading misses some errors</li>
                            <li><strong>Multiple passes:</strong> Focus on one type of error at a time</li>
                        </ul>
                    </div>
                    
                    <div class="rule-box">
                        <h3>What to Check</h3>
                        <ul>
                            <li><strong>Spelling:</strong> Computer spellcheck misses many errors</li>
                            <li><strong>Grammar:</strong> Subject-verb agreement, pronoun reference</li>
                            <li><strong>Punctuation:</strong> Commas, apostrophes, quotation marks</li>
                            <li><strong>Formatting:</strong> Consistency in headings, spacing, fonts</li>
                        </ul>
                    </div>
                    
                    <div class="warning-box">
                        <strong>Don't rely only on spell-check!</strong> It won't catch "there" vs "their" or "affect" vs "effect."
                    </div>
                </div>
                
                <div class="quiz-panel" id="quiz-proofreading-techniques"></div>
                
                <div class="section-footer">
                    <button class="btn btn-primary" onclick="completeSection('proofreading-techniques')">
                        Mark Complete & Continue
                    </button>
                </div>
            </section>

            <!-- Section 16.04: Common Errors -->
            <section class="content-section" id="common-errors">
                <div class="section-header">
                    <h2>16.04 Common Errors</h2>
                </div>
                
                <div class="lesson-content">
                    <p>Recognizing patterns in common errors helps you focus your revision efforts effectively.</p>
                    
                    <div class="rule-box">
                        <h3>Grammar and Usage Errors</h3>
                        <ul>
                            <li><strong>Subject-verb disagreement:</strong> "The team are" ‚Üí "The team is"</li>
                            <li><strong>Dangling modifiers:</strong> "Flying over the city, the lights were beautiful"</li>
                            <li><strong>Sentence fragments:</strong> "Because of the weather."</li>
                            <li><strong>Comma splices:</strong> "It's raining, we'll stay inside"</li>
                        </ul>
                    </div>
                    
                    <div class="rule-box">
                        <h3>Punctuation Problems</h3>
                        <ul>
                            <li><strong>Apostrophe errors:</strong> "it's" vs "its", "1990's" ‚Üí "1990s"</li>
                            <li><strong>Missing commas:</strong> Items in series, before conjunctions</li>
                            <li><strong>Quotation mark placement:</strong> Inside or outside other punctuation</li>
                        </ul>
                    </div>
                    
                    <div class="rule-box">
                        <h3>Word Choice Issues</h3>
                        <ul>
                            <li><strong>Confused pairs:</strong> affect/effect, complement/compliment</li>
                            <li><strong>Redundancy:</strong> "free gift," "past history," "future plans"</li>
                            <li><strong>Wrong prepositions:</strong> "different than" ‚Üí "different from"</li>
                        </ul>
                    </div>
                </div>
                
                <div class="quiz-panel" id="quiz-common-errors"></div>
                
                <div class="section-footer">
                    <button class="btn btn-primary" onclick="completeSection('common-errors')">
                        Mark Complete & Continue
                    </button>
                </div>
            </section>

            <!-- Section 16.05: Technical Accuracy -->
            <section class="content-section" id="technical-accuracy">
                <div class="section-header">
                    <h2>16.05 Technical Accuracy</h2>
                </div>
                
                <div class="lesson-content">
                    <p>Government documents require special attention to technical details, data accuracy, and legal precision.</p>
                    
                    <div class="rule-box">
                        <h3>Data Verification</h3>
                        <ul>
                            <li><strong>Numbers and statistics:</strong> Double-check all figures</li>
                            <li><strong>Dates and times:</strong> Verify accuracy and consistency</li>
                            <li><strong>Names and titles:</strong> Confirm spelling and current positions</li>
                            <li><strong>Legal references:</strong> Check citations and legal accuracy</li>
                        </ul>
                    </div>
                    
                    <div class="rule-box">
                        <h3>Source Verification</h3>
                        <ul>
                            <li><strong>Citations:</strong> Ensure all sources are properly referenced</li>
                            <li><strong>Permissions:</strong> Verify rights to use copyrighted material</li>
                            <li><strong>Currency:</strong> Check that information is current</li>
                            <li><strong>Authority:</strong> Confirm sources are credible</li>
                        </ul>
                    </div>
                    
                    <div class="rule-box">
                        <h3>Consistency Checks</h3>
                        <ul>
                            <li><strong>Terminology:</strong> Use terms consistently throughout</li>
                            <li><strong>Formatting:</strong> Headings, bullets, numbering systems</li>
                            <li><strong>Style:</strong> Follow your organization's style guide</li>
                        </ul>
                    </div>
                </div>
                
                <div class="quiz-panel" id="quiz-technical-accuracy"></div>
                
                <div class="section-footer">
                    <button class="btn btn-primary" onclick="completeSection('technical-accuracy')">
                        Mark Complete & Continue
                    </button>
                </div>
            </section>

            <!-- Section 16.06: Master Checklist -->
            <section class="content-section" id="master-checklist">
                <div class="section-header">
                    <h2>16.06 Master Checklist</h2>
                </div>
                
                <div class="lesson-content">
                    <p>Use this comprehensive checklist to ensure your document meets professional standards.</p>
                    
                    <div class="rule-box">
                        <h3>Content and Organization</h3>
                        <ul>
                            <li>‚òê Purpose is clear and achieved</li>
                            <li>‚òê Information is accurate and current</li>
                            <li>‚òê Organization is logical and effective</li>
                            <li>‚òê Transitions connect ideas smoothly</li>
                            <li>‚òê Conclusion ties everything together</li>
                        </ul>
                    </div>
                    
                    <div class="rule-box">
                        <h3>Language and Style</h3>
                        <ul>
                            <li>‚òê Tone is appropriate for audience</li>
                            <li>‚òê Language is clear and concise</li>
                            <li>‚òê Sentences vary in length and structure</li>
                            <li>‚òê Word choice is precise and professional</li>
                            <li>‚òê Jargon is explained or eliminated</li>
                        </ul>
                    </div>
                    
                    <div class="rule-box">
                        <h3>Mechanics and Format</h3>
                        <ul>
                            <li>‚òê Spelling is correct throughout</li>
                            <li>‚òê Grammar and punctuation are correct</li>
                            <li>‚òê Formatting is consistent</li>
                            <li>‚òê Citations are complete and correct</li>
                            <li>‚òê Document follows organizational style</li>
                        </ul>
                    </div>
                </div>
                
                <div class="quiz-panel" id="quiz-master-checklist"></div>
                
                <div class="section-footer">
                    <button class="btn btn-primary" onclick="completeSection('master-checklist')">
                        Mark Complete & Continue
                    </button>
                </div>
            </section>

            <!-- Section 16.07: Final Review -->
            <section class="content-section" id="final-review">
                <div class="section-header">
                    <h2>16.07 Final Review</h2>
                </div>
                
                <div class="lesson-content">
                    <p>The final review ensures your document is ready for distribution and represents your organization professionally.</p>
                    
                    <div class="rule-box">
                        <h3>Final Review Process</h3>
                        <ul>
                            <li><strong>Fresh eyes:</strong> Have someone else review the document</li>
                            <li><strong>Read aloud:</strong> Final check for flow and clarity</li>
                            <li><strong>Print version:</strong> Review on paper, not just screen</li>
                            <li><strong>All formats:</strong> Check electronic and print versions</li>
                        </ul>
                    </div>
                    
                    <div class="rule-box">
                        <h3>Distribution Readiness</h3>
                        <ul>
                            <li><strong>Approvals:</strong> All necessary signatures and approvals</li>
                            <li><strong>Completeness:</strong> All required sections included</li>
                            <li><strong>Accessibility:</strong> Document meets accessibility standards</li>
                            <li><strong>File formats:</strong> Saved in appropriate formats</li>
                        </ul>
                    </div>
                    
                    <div class="success-box">
                        <strong>Success!</strong> A well-revised and proofread document reflects professionalism and attention to detail‚Äîkey qualities in government communication.
                    </div>
                </div>
                
                <div class="quiz-panel" id="quiz-final-review"></div>
                
                <div class="section-footer">
                    <button class="btn btn-primary" onclick="completeSection('final-review')">
                        Chapter Complete!
                    </button>
                </div>
            </section>
        </div>
    </main>

    <footer class="site-footer">
        <div class="container">
            <p>&copy; 2024 Government of Canada. Based on <em>The Canadian Style</em> (1997 revised edition)</p>
        </div>
    </footer>

    <!-- Include JavaScript -->
    <script type="module">
        import { getProgress, setProgress } from '../shared/js/progress.js';
        import { QuizEngine } from '../shared/js/quiz-engine.js';
        import '../shared/js/components.js';
        
        const CHAPTER_ID = 'ch16';
        const sections = [
            { id: 'introduction', title: '16.01 Introduction' },
            { id: 'revision-process', title: '16.02 Revision Process' },
            { id: 'proofreading-techniques', title: '16.03 Proofreading' },
            { id: 'common-errors', title: '16.04 Common Errors' },
            { id: 'technical-accuracy', title: '16.05 Technical Accuracy' },
            { id: 'master-checklist', title: '16.06 Master Checklist' },
            { id: 'final-review', title: '16.07 Final Review' }
        ];

        // Section mapping for ch16
        const SECTION_MAPPING = {
            'revision-process': 'revision-strategies'
        };

        // ‚úÖ ◊î◊ï◊°◊§◊™ ◊§◊ï◊†◊ß◊¶◊ô◊ô◊™ showSection ◊î◊ó◊°◊®◊î
        function showSection(sectionId) {
            // ◊î◊°◊™◊®◊™ ◊õ◊ú ◊î◊ó◊ú◊ß◊ô◊ù
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
                section.style.display = 'none';
            });
            
            // ◊î◊¶◊í◊™ ◊î◊ó◊ú◊ß ◊î◊†◊ï◊õ◊ó◊ô
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.add('active');
                targetSection.style.display = 'block';
            }
        }

        // ‚úÖ ◊î◊ï◊°◊§◊™ ◊§◊ï◊†◊ß◊¶◊ô◊ô◊™ updateActiveTab ◊î◊ó◊°◊®◊î
        function updateActiveTab(activeLink) {
            document.querySelectorAll('.tab-link').forEach(link => {
                link.classList.remove('active');
            });
            if (activeLink) {
                activeLink.classList.add('active');
            }
        }

        // ‚úÖ ◊î◊ï◊°◊§◊™ ◊§◊ï◊†◊ß◊¶◊ô◊ô◊™ initSectionNavigation ◊î◊ó◊°◊®◊î
        function initSectionNavigation() {
            const tabLinks = document.querySelectorAll('.tab-link');
            
            tabLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const sectionId = this.getAttribute('data-section');
                    showSection(sectionId);
                    updateActiveTab(this);
                });
            });
            
            // ◊î◊¶◊í◊™ ◊î◊ó◊ú◊ß ◊î◊®◊ê◊©◊ï◊ü ◊õ◊ë◊®◊ô◊®◊™ ◊û◊ó◊ì◊ú
            showSection('introduction');
        }
        
        // ‚úÖ ◊î◊ï◊°◊§◊™ ◊§◊ï◊†◊ß◊¶◊ô◊ô◊™ updateProgressBar ◊î◊ó◊°◊®◊î
        function updateProgressBar() {
            const progress = getProgress(CHAPTER_ID);
            const chapterProgress = progress || {};
            const completed = Object.values(chapterProgress).filter(Boolean).length;
            const percentage = Math.round((completed / sections.length) * 100);
            
            const progressBar = document.getElementById('chapterProgress');
            if (progressBar) {
                progressBar.style.width = percentage + '%';
            }
        }
        
        // ‚úÖ ◊™◊ô◊ß◊ï◊ü ◊§◊ï◊†◊ß◊¶◊ô◊ô◊™ completeSection
        window.completeSection = function(sectionId) {
            setProgress(CHAPTER_ID, sectionId, true);
            updateProgressBar();
            
            // Navigate to next section
            const currentIndex = sections.findIndex(s => s.id === sectionId);
            if (currentIndex !== -1 && currentIndex < sections.length - 1) {
                const nextSection = sections[currentIndex + 1];
                showSection(nextSection.id);
                updateActiveTab(document.querySelector(`[data-section="${nextSection.id}"]`));
            } else {
                // Chapter complete
                showCompletionModal();
            }
        };
        
        // ‚úÖ ◊î◊ï◊°◊§◊™ ◊§◊ï◊†◊ß◊¶◊ô◊ô◊™ showCompletionModal ◊î◊ó◊°◊®◊î
        function showCompletionModal() {
            const modal = document.createElement('div');
            modal.className = 'completion-modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <h3>üéâ Chapter 16 Complete!</h3>
                    <p>Congratulations! You've completed The Canadian Style course. Your writing skills are now polished and professional.</p>
                    <div class="modal-buttons">
                        <button onclick="window.location.href='../index.html'" class="btn btn-primary">
                            Back to Dashboard
                        </button>
                        <button onclick="window.location.href='../certificate.html'" class="btn btn-secondary">
                            View Certificate
                        </button>
                    </div>
                </div>
            `;
            
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
            
            document.body.appendChild(modal);
        }
        
        // Enhanced quiz loading with mapping
        async function loadSectionQuizzes() {
            try {
                console.log(`üîç Loading quizzes for ${CHAPTER_ID}...`);
                
                const response = await fetch(`../data/${CHAPTER_ID}-quiz.json`);
                if (!response.ok) {
                    console.warn(`üìÑ Quiz data not available for ${CHAPTER_ID} (${response.status})`);
                    return;
                }
                
                const quizData = await response.json();
                const availableQuizSections = Object.keys(quizData.sections || {});
                console.log(`üìö Available quiz sections: [${availableQuizSections.join(', ')}]`);
                
                let successCount = 0;
                
                // Initialize quizzes for sections that have them
                sections.forEach(section => {
                    const htmlSectionId = section.id;
                    
                    // Try different strategies to find matching quiz
                    let quizSectionId = null;
                    let matchType = '';
                    
                    // Strategy 1: Direct match
                    if (quizData.sections?.[htmlSectionId]) {
                        quizSectionId = htmlSectionId;
                        matchType = 'direct';
                    }
                    // Strategy 2: Use mapping
                    else if (SECTION_MAPPING[htmlSectionId] && quizData.sections?.[SECTION_MAPPING[htmlSectionId]]) {
                        quizSectionId = SECTION_MAPPING[htmlSectionId];
                        matchType = 'mapped';
                    }
                    // Strategy 3: Fuzzy match by keywords
                    else {
                        const htmlWords = htmlSectionId.split('-');
                        const fuzzyMatch = availableQuizSections.find(quizId => {
                            const quizWords = quizId.split('-');
                            return htmlWords.some(word => 
                                quizWords.includes(word) || 
                                quizId.includes(word) ||
                                (word.length > 3 && quizId.includes(word.substring(0, 4)))
                            );
                        });
                        
                        if (fuzzyMatch) {
                            quizSectionId = fuzzyMatch;
                            matchType = 'fuzzy';
                        }
                    }
                    
                    // Create quiz if we found a match
                    if (quizSectionId && quizData.sections[quizSectionId]) {
                        const sectionQuizData = quizData.sections[quizSectionId];
                        
                        if (sectionQuizData.questions && sectionQuizData.questions.length > 0) {
                            const quizContainer = document.getElementById(`quiz-${htmlSectionId}`);
                            
                            if (quizContainer) {
                                console.log(`‚úÖ Creating quiz for "${htmlSectionId}" using "${quizSectionId}" (${matchType}) - ${sectionQuizData.questions.length} questions`);
                                
                                const quizEngine = new QuizEngine(sectionQuizData, CHAPTER_ID, htmlSectionId);
                                quizEngine.render(quizContainer);
                                successCount++;
                            } else {
                                console.warn(`üì¶ Quiz container not found: quiz-${htmlSectionId}`);
                            }
                        } else {
                            console.warn(`‚ùì No questions found in section ${quizSectionId}`);
                        }
                    } else {
                        console.log(`‚ùå No quiz match found for "${htmlSectionId}"`);
                        
                        // Show available options for debugging
                        if (availableQuizSections.length > 0) {
                            console.log(`üí° Available: [${availableQuizSections.join(', ')}]`);
                        }
                    }
                });
                
                console.log(`üéØ Successfully loaded ${successCount}/${sections.length} quizzes for ${CHAPTER_ID}`);
                
            } catch (error) {
                console.error(`üí• Error loading quiz data for ${CHAPTER_ID}:`, error);
            }
        }
        
        // ‚úÖ ◊î◊®◊¶◊™ ◊õ◊ú ◊î◊§◊ï◊†◊ß◊¶◊ô◊ï◊™ ◊ú◊ê◊ó◊® ◊ò◊¢◊ô◊†◊™ ◊î◊ì◊£
        document.addEventListener('DOMContentLoaded', function() {
            console.log(`üöÄ Initializing ${CHAPTER_ID}...`);
            
            initSectionNavigation();
            updateProgressBar();
            loadSectionQuizzes();
            
            console.log(`‚úÖ ${CHAPTER_ID} initialized successfully`);
        });

        // Handle window beforeunload for quiz warnings
        window.addEventListener('beforeunload', (event) => {
            const activeQuiz = document.querySelector('.quiz-engine-container .quiz-in-progress');
            if (activeQuiz) {
                event.preventDefault();
                event.returnValue = 'You have a quiz in progress. Are you sure you want to leave?';
            }
        });
    </script>
</body>
</html>
