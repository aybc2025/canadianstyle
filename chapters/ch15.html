<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chapter 15: Geographical Names - The Canadian Style</title>
    <link rel="stylesheet" href="../shared/css/styles.css">
    <link rel="stylesheet" href="../shared/css/chapter.css">
</head>
<body>
    <header class="site-header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <h1><a href="../index.html">The Canadian Style</a></h1>
                </div>
                <nav class="main-nav">
                    <a href="../index.html">Home</a>
                    <a href="../about.html">About</a>
                </nav>
            </div>
        </div>
    </header>

    <nav class="chapter-nav">
        <div class="container">
            <div class="chapter-header">
                <h2>Chapter 15: Geographical Names</h2>
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="chapterProgress"></div>
                    </div>
                    <span class="progress-text">Progress</span>
                </div>
            </div>
            
            <div class="section-tabs" id="sectionNav">
                <a href="#introduction" class="tab-link active" data-section="introduction">15.01 Introduction</a>
                <a href="#canadian-places" class="tab-link" data-section="canadian-places">15.02 Canadian Places</a>
                <a href="#foreign-places" class="tab-link" data-section="foreign-places">15.03 Foreign Places</a>
                <a href="#provinces-territories" class="tab-link" data-section="provinces-territories">15.04 Provinces & Territories</a>
                <a href="#indigenous-names" class="tab-link" data-section="indigenous-names">15.05 Indigenous Names</a>
                <a href="#abbreviations" class="tab-link" data-section="abbreviations">15.06 Abbreviations</a>
            </div>
        </div>
    </nav>

    <main class="chapter-content">
        <div class="container">
            <!-- Section 15.01: Introduction -->
            <section class="content-section active" id="introduction">
                <div class="section-header">
                    <h2>15.01 Introduction</h2>
                </div>
                
                <div class="lesson-content">
                    <p>Geographical names require careful attention to official spellings, preferred forms, and cultural sensitivity. This chapter provides guidance for using place names correctly in Canadian government documents.</p>
                    
                    <div class="key-point">
                        <strong>Key Principle:</strong> Use official geographical names and respect Indigenous naming conventions while ensuring consistency in government communications.
                    </div>
                </div>
                
                <div class="section-footer">
                    <button class="btn btn-primary" onclick="completeSection('introduction')">
                        Mark Complete & Continue
                    </button>
                </div>
            </section>

            <!-- Section 15.02: Canadian Places -->
            <section class="content-section" id="canadian-places">
                <div class="section-header">
                    <h2>15.02 Canadian Places</h2>
                </div>
                
                <div class="lesson-content">
                    <p>Canadian geographical names follow standards established by the Geographical Names Board of Canada.</p>
                    
                    <div class="rule-box">
                        <h3>Official Names</h3>
                        <ul>
                            <li><strong>Cities:</strong> Toronto, Montréal, Vancouver, St. John's</li>
                            <li><strong>Natural features:</strong> Lake Superior, Rocky Mountains, Bay of Fundy</li>
                            <li><strong>Regions:</strong> Atlantic Canada, the Prairies, the North</li>
                        </ul>
                    </div>
                    
                    <div class="rule-box">
                        <h3>Capitalization Rules</h3>
                        <ul>
                            <li><strong>Proper names:</strong> Always capitalize (Niagara Falls)</li>
                            <li><strong>Generic terms:</strong> Lowercase when not part of name (the falls)</li>
                            <li><strong>Directional terms:</strong> Northern Ontario vs northern regions</li>
                        </ul>
                    </div>
                    
                    <div class="example-box">
                        <h3>Examples</h3>
                        <ul>
                            <li>✅ "Parliament Hill" (specific location) vs "the hill" (generic)</li>
                            <li>✅ "Fraser River" (official name) vs "the river" (reference)</li>
                            <li>✅ "Eastern Canada" (region) vs "eastern provinces" (direction)</li>
                        </ul>
                    </div>
                </div>
                
                <div class="quiz-panel" id="quiz-canadian-places"></div>
                
                <div class="section-footer">
                    <button class="btn btn-primary" onclick="completeSection('canadian-places')">
                        Mark Complete & Continue
                    </button>
                </div>
            </section>

            <!-- Section 15.03: Foreign Places -->
            <section class="content-section" id="foreign-places">
                <div class="section-header">
                    <h2>15.03 Foreign Places</h2>
                </div>
                
                <div class="lesson-content">
                    <p>Foreign geographical names should use conventional English spellings or transliterations accepted in Canadian usage.</p>
                    
                    <div class="rule-box">
                        <h3>Conventional English Names</h3>
                        <ul>
                            <li><strong>Major cities:</strong> Rome (not Roma), Vienna (not Wien)</li>
                            <li><strong>Countries:</strong> Germany (not Deutschland), Japan (not Nippon)</li>
                            <li><strong>Bodies of water:</strong> Rhine River, Mediterranean Sea</li>
                        </ul>
                    </div>
                    
                    <div class="rule-box">
                        <h3>When to Use Original Names</h3>
                        <ul>
                            <li><strong>No established English form</strong> exists</li>
                            <li><strong>Official government documents</strong> require precision</li>
                            <li><strong>Cultural sensitivity</strong> is important</li>
                            <li><strong>Recent name changes</strong> haven't been anglicized</li>
                        </ul>
                    </div>
                    
                    <div class="example-box">
                        <h3>Examples</h3>
                        <ul>
                            <li>✅ Beijing (modern usage) not Peking (historical)</li>
                            <li>✅ Myanmar or Burma (depending on context and sensitivity)</li>
                            <li>✅ Côte d'Ivoire (official) or Ivory Coast (conventional)</li>
                        </ul>
                    </div>
                </div>
                
                <div class="quiz-panel" id="quiz-foreign-places"></div>
                
                <div class="section-footer">
                    <button class="btn btn-primary" onclick="completeSection('foreign-places')">
                        Mark Complete & Continue
                    </button>
                </div>
            </section>

            <!-- Section 15.04: Provinces & Territories -->
            <section class="content-section" id="provinces-territories">
                <div class="section-header">
                    <h2>15.04 Provinces & Territories</h2>
                </div>
                
                <div class="lesson-content">
                    <p>Canadian provinces and territories have official names and standard abbreviations for different contexts.</p>
                    
                    <div class="rule-box">
                        <h3>Official Names</h3>
                        <ul>
                            <li><strong>Newfoundland and Labrador</strong> (not just "Newfoundland")</li>
                            <li><strong>Prince Edward Island</strong> (spell out in formal contexts)</li>
                            <li><strong>Northwest Territories</strong> (not "North West Territories")</li>
                        </ul>
                    </div>
                    
                    <div class="rule-box">
                        <h3>Standard Abbreviations</h3>
                        <ul>
                            <li><strong>Two-letter postal:</strong> NL, PE, NS, NB, QC, ON, MB, SK, AB, BC, YT, NT, NU</li>
                            <li><strong>Traditional:</strong> Nfld., P.E.I., N.S., N.B., Que., Ont., Man., Sask., Alta., B.C.</li>
                        </ul>
                    </div>
                    
                    <div class="example-box">
                        <h3>Usage Guidelines</h3>
                        <ul>
                            <li>Use full names in formal documents</li>
                            <li>Postal codes for mailing addresses</li>
                            <li>Traditional abbreviations for space constraints</li>
                            <li>Be consistent within each document</li>
                        </ul>
                    </div>
                </div>
                
                <div class="quiz-panel" id="quiz-provinces-territories"></div>
                
                <div class="section-footer">
                    <button class="btn btn-primary" onclick="completeSection('provinces-territories')">
                        Mark Complete & Continue
                    </button>
                </div>
            </section>

            <!-- Section 15.05: Indigenous Names -->
            <section class="content-section" id="indigenous-names">
                <div class="section-header">
                    <h2>15.05 Indigenous Names</h2>
                </div>
                
                <div class="lesson-content">
                    <p>Indigenous place names require special care to ensure respectful and accurate usage, following preferences of Indigenous communities.</p>
                    
                    <div class="rule-box">
                        <h3>Respectful Usage</h3>
                        <ul>
                            <li><strong>Use preferred names</strong> as designated by Indigenous communities</li>
                            <li><strong>Respect traditional spellings</strong> and pronunciation guides</li>
                            <li><strong>Include both names</strong> when transitioning to Indigenous names</li>
                        </ul>
                    </div>
                    
                    <div class="rule-box">
                        <h3>Name Restoration</h3>
                        <ul>
                            <li><strong>Growing recognition</strong> of traditional names</li>
                            <li><strong>Official restoration projects</strong> across Canada</li>
                            <li><strong>Dual naming periods</strong> during transitions</li>
                        </ul>
                    </div>
                    
                    <div class="example-box">
                        <h3>Examples</h3>
                        <ul>
                            <li>Denali (Alaska) - traditional name restored</li>
                            <li>Haida Gwaii (formerly Queen Charlotte Islands)</li>
                            <li>Iqaluit (Nunavut capital)</li>
                            <li>Traditional territory acknowledgments in documents</li>
                        </ul>
                    </div>
                    
                    <div class="note-box">
                        <strong>Note:</strong> When uncertain about Indigenous place names, consult with relevant Indigenous organizations or the Geographical Names Board of Canada.
                    </div>
                </div>
                
                <div class="quiz-panel" id="quiz-indigenous-names"></div>
                
                <div class="section-footer">
                    <button class="btn btn-primary" onclick="completeSection('indigenous-names')">
                        Mark Complete & Continue
                    </button>
                </div>
            </section>

            <!-- Section 15.06: Abbreviations -->
            <section class="content-section" id="abbreviations">
                <div class="section-header">
                    <h2>15.06 Abbreviations</h2>
                </div>
                
                <div class="lesson-content">
                    <p>Geographical abbreviations follow specific patterns and should be used consistently within documents.</p>
                    
                    <div class="rule-box">
                        <h3>Street Types</h3>
                        <ul>
                            <li><strong>Ave.</strong> (Avenue), <strong>St.</strong> (Street), <strong>Blvd.</strong> (Boulevard)</li>
                            <li><strong>Rd.</strong> (Road), <strong>Dr.</strong> (Drive), <strong>Cres.</strong> (Crescent)</li>
                            <li><strong>Spell out</strong> in formal contexts</li>
                        </ul>
                    </div>
                    
                    <div class="rule-box">
                        <h3>Directional Terms</h3>
                        <ul>
                            <li><strong>N.</strong> (North), <strong>S.</strong> (South), <strong>E.</strong> (East), <strong>W.</strong> (West)</li>
                            <li><strong>NE, NW, SE, SW</strong> for compound directions</li>
                            <li><strong>Use periods</strong> in traditional abbreviations</li>
                        </ul>
                    </div>
                    
                    <div class="rule-box">
                        <h3>Geographic Features</h3>
                        <ul>
                            <li><strong>Mt.</strong> (Mount), <strong>Is.</strong> (Island), <strong>L.</strong> (Lake)</li>
                            <li><strong>R.</strong> (River), <strong>Pt.</strong> (Point), <strong>Co.</strong> (County)</li>
                            <li><strong>Generally avoid</strong> abbreviating in running text</li>
                        </ul>
                    </div>
                    
                    <div class="example-box">
                        <h3>Usage Context</h3>
                        <ul>
                            <li><strong>Addresses:</strong> 123 Main St., Toronto, ON</li>
                            <li><strong>Maps and charts:</strong> Mt. Logan, L. Superior</li>
                            <li><strong>Formal text:</strong> Mount Logan, Lake Superior</li>
                            <li><strong>Lists and tables:</strong> Abbreviations acceptable</li>
                        </ul>
                    </div>
                </div>
                
                <div class="quiz-panel" id="quiz-abbreviations"></div>
                
                <div class="section-footer">
                    <button class="btn btn-primary" onclick="completeSection('abbreviations')">
                        Chapter Complete!
                    </button>
                </div>
            </section>
        </div>
    </main>

    <footer class="site-footer">
        <div class="container">
            <p>&copy; 2024 Government of Canada. Based on <em>The Canadian Style</em> (1997 revised edition)</p>
        </div>
    </footer>

    <!-- Include JavaScript -->
    <script src="../shared/js/quiz-engine.js"></script>

    <script>
        const CHAPTER_ID = 'ch15';
        const sections = [
            { id: 'introduction', title: '15.01 Introduction' },
            { id: 'canadian-places', title: '15.02 Canadian Places' },
            { id: 'foreign-places', title: '15.03 Foreign Places' },
            { id: 'provinces-territories', title: '15.04 Provinces & Territories' },
            { id: 'indigenous-names', title: '15.05 Indigenous Names' },
            { id: 'abbreviations', title: '15.06 Abbreviations' }
        ];

        // Section mapping for ch15 - most sections should match directly
        const SECTION_MAPPING = {};

        // ✅ Progress management functions
        function getChapterProgress(chapterId) {
            try {
                const progress = JSON.parse(localStorage.getItem('chapterProgress') || '{}');
                return progress[chapterId] || {};
            } catch (error) {
                console.warn('Error loading progress:', error);
                return {};
            }
        }

        function setProgress(chapterId, sectionId, completed) {
            try {
                const progress = JSON.parse(localStorage.getItem('chapterProgress') || '{}');
                if (!progress[chapterId]) {
                    progress[chapterId] = {};
                }
                progress[chapterId][sectionId] = completed;
                localStorage.setItem('chapterProgress', JSON.stringify(progress));
                console.log(`✅ Progress saved: ${chapterId}/${sectionId} = ${completed}`);
            } catch (error) {
                console.warn('Error saving progress:', error);
            }
        }
        
        // Initialize section navigation
        function initSectionNavigation() {
            const tabLinks = document.querySelectorAll('.tab-link');
            const contentSections = document.querySelectorAll('.content-section');
            
            tabLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Remove active from all
                    tabLinks.forEach(l => l.classList.remove('active'));
                    contentSections.forEach(s => s.classList.remove('active'));
                    
                    // Add active to clicked tab
                    this.classList.add('active');
                    
                    // Show corresponding section
                    const sectionId = this.getAttribute('data-section');
                    const section = document.getElementById(sectionId);
                    if (section) {
                        section.classList.add('active');
                    }
                    
                    // Update URL hash
                    window.location.hash = sectionId;
                });
            });
        }
        
        // Update progress bar
        function updateProgressBar() {
            const chapterProgress = getChapterProgress(CHAPTER_ID);
            const completed = Object.values(chapterProgress).filter(Boolean).length;
            const percentage = Math.round((completed / sections.length) * 100);
            
            const progressBar = document.getElementById('chapterProgress');
            if (progressBar) {
                progressBar.style.width = percentage + '%';
            }
        }
        
        // Complete section function
        window.completeSection = function(sectionId) {
            setProgress(CHAPTER_ID, sectionId, true);
            updateProgressBar();
            
            // Navigate to next section
            const currentIndex = sections.findIndex(s => s.id === sectionId);
            if (currentIndex !== -1 && currentIndex < sections.length - 1) {
                const nextSection = sections[currentIndex + 1];
                showSection(nextSection.id);
                updateActiveTab(document.querySelector(`[data-section="${nextSection.id}"]`));
            } else {
                // Chapter complete
                showCompletionModal();
            }
        };
        
        function showSection(sectionId) {
            const contentSections = document.querySelectorAll('.content-section');
            contentSections.forEach(s => s.classList.remove('active'));
            
            const section = document.getElementById(sectionId);
            if (section) {
                section.classList.add('active');
                window.location.hash = sectionId;
            }
        }
        
        function updateActiveTab(tab) {
            const tabLinks = document.querySelectorAll('.tab-link');
            tabLinks.forEach(l => l.classList.remove('active'));
            if (tab) tab.classList.add('active');
        }
        
        function showCompletionModal() {
            const modal = document.createElement('div');
            modal.className = 'completion-modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <h3>🎉 Chapter 15 Complete!</h3>
                    <p>You've mastered geographical names! Your documents will now use place names correctly and respectfully.</p>
                    <div class="modal-buttons">
                        <button onclick="window.location.href='../index.html'" class="btn btn-primary">
                            Back to Dashboard
                        </button>
                        <button onclick="window.location.href='ch16.html'" class="btn btn-secondary">
                            Next Chapter: Revision & Proofreading
                        </button>
                    </div>
                </div>
            `;
            
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
            
            document.body.appendChild(modal);
        }
        
        // Enhanced quiz loading with mapping
        async function loadSectionQuizzes() {
            try {
                console.log(`🔍 Loading quizzes for ${CHAPTER_ID}...`);
                
                const response = await fetch(`../data/${CHAPTER_ID}-quiz.json`);
                if (!response.ok) {
                    console.warn(`📄 Quiz data not available for ${CHAPTER_ID} (${response.status})`);
                    return;
                }
                
                const quizData = await response.json();
                const availableQuizSections = Object.keys(quizData.sections || {});
                console.log(`📚 Available quiz sections: [${availableQuizSections.join(', ')}]`);
                
                let successCount = 0;
                
                // Initialize quizzes for sections that have them
                sections.forEach(section => {
                    const htmlSectionId = section.id;
                    
                    // Try different strategies to find matching quiz
                    let quizSectionId = null;
                    let matchType = '';
                    
                    // Strategy 1: Direct match
                    if (quizData.sections?.[htmlSectionId]) {
                        quizSectionId = htmlSectionId;
                        matchType = 'direct';
                    }
                    // Strategy 2: Use mapping
                    else if (SECTION_MAPPING[htmlSectionId] && quizData.sections?.[SECTION_MAPPING[htmlSectionId]]) {
                        quizSectionId = SECTION_MAPPING[htmlSectionId];
                        matchType = 'mapped';
                    }
                    // Strategy 3: Fuzzy match by keywords
                    else {
                        const htmlWords = htmlSectionId.split('-');
                        const fuzzyMatch = availableQuizSections.find(quizId => {
                            const quizWords = quizId.split('-');
                            return htmlWords.some(word => 
                                quizWords.includes(word) || 
                                quizId.includes(word) ||
                                (word.length > 3 && quizId.includes(word.substring(0, 4)))
                            );
                        });
                        
                        if (fuzzyMatch) {
                            quizSectionId = fuzzyMatch;
                            matchType = 'fuzzy';
                        }
                    }
                    
                    // Create quiz if we found a match
                    if (quizSectionId && quizData.sections[quizSectionId]) {
                        const sectionQuizData = quizData.sections[quizSectionId];
                        
                        if (sectionQuizData.questions && sectionQuizData.questions.length > 0) {
                            const quizContainer = document.getElementById(`quiz-${htmlSectionId}`);
                            
                            if (quizContainer) {
                                console.log(`✅ Creating quiz for "${htmlSectionId}" using "${quizSectionId}" (${matchType}) - ${sectionQuizData.questions.length} questions`);
                                
                                const quizEngine = new QuizEngine(sectionQuizData, CHAPTER_ID, htmlSectionId);
                                quizEngine.render(quizContainer);
                                successCount++;
                            } else {
                                console.warn(`📦 Quiz container not found: quiz-${htmlSectionId}`);
                            }
                        } else {
                            console.warn(`❓ No questions found in section ${quizSectionId}`);
                        }
                    } else {
                        console.log(`❌ No quiz match found for "${htmlSectionId}"`);
                        
                        // Show available options for debugging
                        if (availableQuizSections.length > 0) {
                            console.log(`💡 Available: [${availableQuizSections.join(', ')}]`);
                        }
                    }
                });
                
                console.log(`🎯 Successfully loaded ${successCount}/${sections.length} quizzes for ${CHAPTER_ID}`);
                
            } catch (error) {
                console.error(`💥 Error loading quiz data for ${CHAPTER_ID}:`, error);
            }
        }
        
        // Initialize page - STANDARDIZED
        document.addEventListener('DOMContentLoaded', function() {
            console.log(`🚀 Initializing ${CHAPTER_ID}...`);
            
            initSectionNavigation();
            updateProgressBar();
            loadSectionQuizzes();
            
            console.log(`✅ ${CHAPTER_ID} initialized successfully`);
        });

        // Handle window beforeunload for quiz warnings
        window.addEventListener('beforeunload', (event) => {
            const activeQuiz = document.querySelector('.quiz-engine-container .quiz-in-progress');
            if (activeQuiz) {
                event.preventDefault();
                event.returnValue = 'You have a quiz in progress. Are you sure you want to leave?';
            }
        });
    </script>
</body>
</html>
