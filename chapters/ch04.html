<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chapter 4: Capitalization - The Canadian Style</title>
    <link rel="stylesheet" href="../shared/css/main.css">
    <link rel="stylesheet" href="../shared/css/quiz-styles.css">
</head>
<body>
    <div class="chapter-container">
        <header class="chapter-header">
            <div class="breadcrumb">
                <a href="../index.html" class="breadcrumb-link">← Dashboard</a>
                <span class="breadcrumb-separator">/</span>
                <span class="breadcrumb-current">Chapter 4: Capitalization</span>
            </div>
            <div class="chapter-progress">
                <div class="progress-bar">
                    <div class="progress-fill" id="chapterProgress"></div>
                </div>
                <span class="progress-text">Progress</span>
            </div>
        </header>

        <nav class="chapter-nav">
            <div class="nav-links">
                <a href="#introduction" class="tab-link active" data-section="introduction">4.01 Introduction</a>
                <a href="#initial-words" class="tab-link" data-section="initial-words">4.02 Initial Words</a>
                <a href="#personal-names" class="tab-link" data-section="personal-names">4.03 Personal Names</a>
                <a href="#government" class="tab-link" data-section="government">4.05 Government Bodies</a>
                <a href="#titles" class="tab-link" data-section="titles">4.08 Titles of Office</a>
                <a href="#geography" class="tab-link" data-section="geography">4.21 Geographical Terms</a>
                <a href="#publications" class="tab-link" data-section="publications">4.29 Publications</a>
                <a href="#headings" class="tab-link" data-section="headings">4.31 Headings</a>
            </div>
        </nav>

        <main class="chapter-content">
            <!-- Introduction Section -->
            <section class="content-section" id="introduction">
                <div class="section-header">
                    <h2>4.01 Introduction to Capitalization</h2>
                </div>
                
                <div class="content-block">
                    <p>Proper capitalization enhances clarity and shows respect for names, titles, and important concepts. This chapter covers Canadian government conventions for capitalizing various elements in official writing.</p>
                    
                    <div class="key-principles">
                        <h3>General Principles</h3>
                        <ul>
                            <li>Capitalize proper nouns and adjectives</li>
                            <li>Use capitals sparingly for maximum impact</li>
                            <li>Follow Canadian government conventions</li>
                            <li>Be consistent throughout documents</li>
                        </ul>
                    </div>
                    
                    <div class="examples-grid">
                        <div class="example-item">
                            <h4>Basic Rules</h4>
                            <ul>
                                <li>First word of sentences</li>
                                <li>Proper names: <em>John Smith, Ottawa</em></li>
                                <li>Official titles: <em>Prime Minister</em></li>
                                <li>Government bodies: <em>Parliament</em></li>
                            </ul>
                        </div>
                        
                        <div class="example-item">
                            <h4>Avoid Over-Capitalizing</h4>
                            <ul>
                                <li>Common nouns: <em>the minister</em></li>
                                <li>General references: <em>federal government</em></li>
                                <li>Generic titles: <em>a deputy minister</em></li>
                                <li>Compass directions: <em>north, south</em></li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <!-- Quiz Panel for Introduction -->
                <div class="quiz-panel" id="quiz-introduction"></div>
                
                <div class="section-footer">
                    <button class="btn btn-primary" onclick="completeSection('introduction')">
                        Mark Complete & Continue
                    </button>
                </div>
            </section>

            <!-- Initial Words Section -->
            <section class="content-section" id="initial-words" style="display: none;">
                <div class="section-header">
                    <h2>4.02 Initial Words</h2>
                </div>
                
                <div class="content-block">
                    <div class="rule-box">
                        <h4>Capitalize First Words Of:</h4>
                        <ul>
                            <li>Sentences and sentence fragments</li>
                            <li>Direct quotations</li>
                            <li>Lines of poetry</li>
                            <li>Items in formal lists</li>
                            <li>Headings and titles</li>
                        </ul>
                    </div>
                    
                    <div class="examples-grid">
                        <div class="example-item">
                            <h4>Sentences & Quotations</h4>
                            <ul>
                                <li>The report was completed on time.</li>
                                <li>She said, "The meeting is at 2 p.m."</li>
                                <li>Question: How many attended?</li>
                                <li>Note: This applies to all documents.</li>
                            </ul>
                        </div>
                        
                        <div class="example-item">
                            <h4>Lists & Headings</h4>
                            <ul>
                                <li>The following items are required:</li>
                                <li>• Application form</li>
                                <li>• Two references</li>
                                <li>• Proof of identity</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <!-- Quiz Panel for Initial Words -->
                <div class="quiz-panel" id="quiz-initial-words"></div>
                
                <div class="section-footer">
                    <button class="btn btn-primary" onclick="completeSection('initial-words')">
                        Mark Complete & Continue
                    </button>
                </div>
            </section>

            <!-- Personal Names Section -->
            <section class="content-section" id="personal-names" style="display: none;">
                <div class="section-header">
                    <h2>4.03 Personal Names</h2>
                </div>
                
                <div class="content-block">
                    <div class="rule-box">
                        <h4>Capitalizing Personal Names</h4>
                        <p>All parts of personal names are capitalized, including prefixes and particles.</p>
                    </div>
                    
                    <div class="examples-grid">
                        <div class="example-item">
                            <h4>Names with Prefixes</h4>
                            <ul>
                                <li>Mary MacDonald</li>
                                <li>Jean-Claude Van Damme</li>
                                <li>Ludwig van Beethoven</li>
                                <li>Vincent van Gogh</li>
                                <li>Joachim von Ribbentrop</li>
                            </ul>
                        </div>
                        
                        <div class="example-item">
                            <h4>Special Cases</h4>
                            <ul>
                                <li>O'Connor, O'Neill</li>
                                <li>McLeod, McKenzie</li>
                                <li>St. John, St. Laurent</li>
                                <li>da Vinci, de la Cruz</li>
                                <li>ibn Sina, ben Gurion</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <!-- Quiz Panel for Personal Names -->
                <div class="quiz-panel" id="quiz-personal-names"></div>
                
                <div class="section-footer">
                    <button class="btn btn-primary" onclick="completeSection('personal-names')">
                        Mark Complete & Continue
                    </button>
                </div>
            </section>

            <!-- Government Bodies Section -->
            <section class="content-section" id="government" style="display: none;">
                <div class="section-header">
                    <h2>4.05 Government Bodies</h2>
                </div>
                
                <div class="content-block">
                    <div class="rule-box">
                        <h4>Capitalizing Government Terms</h4>
                        <p>Capitalize specific government bodies, but not general references.</p>
                    </div>
                    
                    <div class="examples-grid">
                        <div class="example-item">
                            <h4>Specific Bodies (Capitalize)</h4>
                            <ul>
                                <li>Parliament, House of Commons</li>
                                <li>Senate, Supreme Court</li>
                                <li>Cabinet, Privy Council</li>
                                <li>Government of Canada</li>
                                <li>Treasury Board</li>
                                <li>Federal Court of Appeal</li>
                            </ul>
                        </div>
                        
                        <div class="example-item">
                            <h4>General References (lowercase)</h4>
                            <ul>
                                <li>federal government</li>
                                <li>the government</li>
                                <li>parliamentary procedure</li>
                                <li>ministerial responsibility</li>
                                <li>cabinet meeting</li>
                                <li>a supreme court</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <!-- Quiz Panel for Government -->
                <div class="quiz-panel" id="quiz-government"></div>
                
                <div class="section-footer">
                    <button class="btn btn-primary" onclick="completeSection('government')">
                        Mark Complete & Continue
                    </button>
                </div>
            </section>

            <!-- Titles of Office Section -->
            <section class="content-section" id="titles" style="display: none;">
                <div class="section-header">
                    <h2>4.08 Titles of Office</h2>
                </div>
                
                <div class="content-block">
                    <div class="rule-box">
                        <h4>When to Capitalize Titles</h4>
                        <ul>
                            <li>Before a person's name</li>
                            <li>When referring to a specific office holder</li>
                            <li>In formal address or signature</li>
                            <li>When standing alone as a title of respect</li>
                        </ul>
                    </div>
                    
                    <div class="examples-grid">
                        <div class="example-item">
                            <h4>Capitalize</h4>
                            <ul>
                                <li>Prime Minister Trudeau</li>
                                <li>The Prime Minister announced...</li>
                                <li>Minister of Finance</li>
                                <li>Chief Justice McLachlin</li>
                                <li>Speaker of the House</li>
                            </ul>
                        </div>
                        
                        <div class="example-item">
                            <h4>Lowercase</h4>
                            <ul>
                                <li>John Smith, prime minister</li>
                                <li>the ministers met</li>
                                <li>a deputy minister</li>
                                <li>former prime minister</li>
                                <li>acting chief justice</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <!-- Quiz Panel for Titles -->
                <div class="quiz-panel" id="quiz-titles"></div>
                
                <div class="section-footer">
                    <button class="btn btn-primary" onclick="completeSection('titles')">
                        Mark Complete & Continue
                    </button>
                </div>
            </section>

            <!-- Geography Section -->
            <section class="content-section" id="geography" style="display: none;">
                <div class="section-header">
                    <h2>4.21 Geographical Terms</h2>
                </div>
                
                <div class="content-block">
                    <div class="rule-box">
                        <h4>Geographical Capitalization</h4>
                        <p>Capitalize proper geographical names but not generic terms.</p>
                    </div>
                    
                    <div class="examples-grid">
                        <div class="example-item">
                            <h4>Proper Names (Capitalize)</h4>
                            <ul>
                                <li>Rocky Mountains</li>
                                <li>Great Lakes</li>
                                <li>Atlantic Ocean</li>
                                <li>Saskatchewan River</li>
                                <li>Hudson Bay</li>
                                <li>Niagara Falls</li>
                            </ul>
                        </div>
                        
                        <div class="example-item">
                            <h4>Generic Terms (lowercase)</h4>
                            <ul>
                                <li>the river</li>
                                <li>the mountains</li>
                                <li>the ocean</li>
                                <li>northern Canada</li>
                                <li>western provinces</li>
                                <li>the falls</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="rule-box">
                        <h4>Compass Directions</h4>
                        <p><strong>Capitalize:</strong> When part of proper name (North America, Western Canada)</p>
                        <p><strong>Lowercase:</strong> When indicating direction (drive north, eastern regions)</p>
                    </div>
                </div>
                
                <!-- Quiz Panel for Geography -->
                <div class="quiz-panel" id="quiz-geography"></div>
                
                <div class="section-footer">
                    <button class="btn btn-primary" onclick="completeSection('geography')">
                        Mark Complete & Continue
                    </button>
                </div>
            </section>

            <!-- Publications Section -->
            <section class="content-section" id="publications" style="display: none;">
                <div class="section-header">
                    <h2>4.29 Publications</h2>
                </div>
                
                <div class="content-block">
                    <div class="rule-box">
                        <h4>Publication Titles</h4>
                        <p>Capitalize the first word, last word, and all important words in titles of publications.</p>
                    </div>
                    
                    <div class="examples-grid">
                        <div class="example-item">
                            <h4>Books & Documents</h4>
                            <ul>
                                <li><em>The Canadian Style</em></li>
                                <li><em>A Guide to Plain Language</em></li>
                                <li><em>Annual Report on Privacy</em></li>
                                <li><em>Procedures for Ministers' Offices</em></li>
                            </ul>
                        </div>
                        
                        <div class="example-item">
                            <h4>Articles & Chapters</h4>
                            <ul>
                                <li>"Using Plain Language in Government"</li>
                                <li>"Chapter 4: Capitalization Rules"</li>
                                <li>"The Art of Clear Writing"</li>
                                <li>"Guidelines for Web Content"</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="rule-box">
                        <h4>Don't Capitalize</h4>
                        <p>Articles (a, an, the), prepositions under 5 letters (of, in, on, to), and coordinating conjunctions (and, but, or) unless they are the first or last word.</p>
                    </div>
                </div>
                
                <!-- Quiz Panel for Publications -->
                <div class="quiz-panel" id="quiz-publications"></div>
                
                <div class="section-footer">
                    <button class="btn btn-primary" onclick="completeSection('publications')">
                        Mark Complete & Continue
                    </button>
                </div>
            </section>

            <!-- Headings Section -->
            <section class="content-section" id="headings" style="display: none;">
                <div class="section-header">
                    <h2>4.31 Headings</h2>
                </div>
                
                <div class="content-block">
                    <div class="rule-box">
                        <h4>Heading Styles</h4>
                        <p>Canadian government writing uses sentence-style capitalization for most headings.</p>
                    </div>
                    
                    <div class="examples-grid">
                        <div class="example-item">
                            <h4>Sentence Style (Preferred)</h4>
                            <ul>
                                <li>Introduction to the program</li>
                                <li>Application procedures</li>
                                <li>Required documentation</li>
                                <li>Contact information</li>
                            </ul>
                        </div>
                        
                        <div class="example-item">
                            <h4>Title Style (Formal Documents)</h4>
                            <ul>
                                <li>Annual Report to Parliament</li>
                                <li>Strategic Plan for Implementation</li>
                                <li>Guidelines for Public Consultation</li>
                                <li>Policy on Official Languages</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="rule-box">
                        <h4>Consistency is Key</h4>
                        <p>Choose one style and use it consistently throughout your document. Sentence style is generally preferred for web content and most government documents.</p>
                    </div>
                </div>
                
                <!-- Quiz Panel for Headings -->
                <div class="quiz-panel" id="quiz-headings"></div>
                
                <div class="section-footer">
                    <button class="btn btn-primary" onclick="completeSection('headings')">
                        Mark Complete & Continue
                    </button>
                </div>
            </section>
        </main>
    </div>

    <!-- Include JavaScript modules -->
    <script type="module" src="../shared/js/router.js"></script>
    <script type="module" src="../shared/js/quiz-engine.js"></script>
    <script type="module" src="../shared/js/progress.js"></script>
    <script type="module" src="../shared/js/components.js"></script>

    <script type="module">
        import { router } from '../shared/js/router.js';
        import { getChapterProgress, setProgress } from '../shared/js/progress.js';
        import { QuizEngine } from '../shared/js/quiz-engine.js';
        
        const CHAPTER_ID = 'ch04';
        const sections = [
            { id: 'introduction', title: '4.01 Introduction' },
            { id: 'initial-words', title: '4.02 Initial Words' },
            { id: 'personal-names', title: '4.03 Personal Names' },
            { id: 'government', title: '4.05 Government Bodies' },
            { id: 'titles', title: '4.08 Titles of Office' },
            { id: 'geography', title: '4.21 Geographical Terms' },
            { id: 'publications', title: '4.29 Publications' },
            { id: 'headings', title: '4.31 Headings' }
        ];
        
        // Initialize router
        router.init(CHAPTER_ID, sections);
        
        // Update progress bar using correct API
        function updateProgressBar() {
            const chapterProgress = getChapterProgress(CHAPTER_ID);
            const completed = Object.values(chapterProgress).filter(Boolean).length;
            const percentage = Math.round((completed / sections.length) * 100);
            
            const progressBar = document.getElementById('chapterProgress');
            if (progressBar) {
                progressBar.style.width = percentage + '%';
            }
        }
        
        // Mark section as complete
        window.completeSection = function(sectionId) {
            setProgress(CHAPTER_ID, sectionId, true);
            updateProgressBar();
            
            // Navigate to next section
            const currentIndex = sections.findIndex(s => s.id === sectionId);
            if (currentIndex < sections.length - 1) {
                const nextSection = sections[currentIndex + 1];
                router.navigateTo(CHAPTER_ID, nextSection.id);
            } else {
                // Chapter complete
                showCompletionModal();
            }
        };
        
        function showCompletionModal() {
            const modal = document.createElement('div');
            modal.className = 'completion-modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <h3>🎉 Chapter 4 Complete!</h3>
                    <p>You've mastered capitalization rules. Ready for the next chapter?</p>
                    <div class="modal-actions">
                        <button class="btn btn-outline" onclick="this.closest('.completion-modal').remove()">
                            Stay Here
                        </button>
                        <a href="../index.html" class="btn btn-primary">
                            Back to Dashboard
                        </a>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        // Load section quizzes - FIXED VERSION
        async function loadSectionQuizzes() {
            // Sample quiz data - in real implementation, this would come from JSON files
            const quizData = {
                introduction: {
                    title: 'Introduction to Capitalization',
                    questions: [
                        {
                            type: 'mcq',
                            stem: 'Which principle guides Canadian government capitalization?',
                            options: [
                                { label: 'Capitalize everything important', correct: false },
                                { label: 'Use capitals sparingly for maximum impact', correct: true },
                                { label: 'Follow American conventions', correct: false },
                                { label: 'Capitalize all nouns', correct: false }
                            ],
                            rationale: 'Canadian style emphasizes judicious use of capitals for clarity and impact.',
                            ref: '§4.01'
                        }
                    ]
                },
                'initial-words': {
                    title: 'Initial Words',
                    questions: [
                        {
                            type: 'true-false',
                            stem: 'The first word of every line in a bulleted list should be capitalized.',
                            correct: true,
                            rationale: 'First words of list items are capitalized in formal lists.',
                            ref: '§4.02'
                        }
                    ]
                },
                'personal-names': {
                    title: 'Personal Names',
                    questions: [
                        {
                            type: 'mcq',
                            stem: 'How should "mary macdonald" be written?',
                            options: [
                                { label: 'mary macdonald', correct: false },
                                { label: 'Mary MacDonald', correct: true },
                                { label: 'Mary Macdonald', correct: false },
                                { label: 'MARY MACDONALD', correct: false }
                            ],
                            rationale: 'Both parts of hyphenated surnames are capitalized.',
                            ref: '§4.03'
                        }
                    ]
                },
                government: {
                    title: 'Government Terms',
                    questions: [
                        {
                            type: 'fill-blank',
                            stem: 'The ___ of Canada announced new policies.',
                            answer: 'Government',
                            rationale: 'Capitalize "Government" in "Government of Canada".',
                            ref: '§4.05'
                        }
                    ]
                },
                titles: {
                    title: 'Titles of Office',
                    questions: [
                        {
                            type: 'mcq',
                            stem: 'Which is correct?',
                            options: [
                                { label: 'prime minister Smith', correct: false },
                                { label: 'Prime Minister Smith', correct: true },
                                { label: 'Prime minister Smith', correct: false },
                                { label: 'PRIME MINISTER Smith', correct: false }
                            ],
                            rationale: 'Capitalize titles when they appear before a person\'s name.',
                            ref: '§4.08'
                        }
                    ]
                },
                geography: {
                    title: 'Geographical Terms',
                    questions: [
                        {
                            type: 'mcq',
                            stem: 'Which is correct?',
                            options: [
                                { label: 'the rocky mountains', correct: false },
                                { label: 'The Rocky Mountains', correct: true },
                                { label: 'the Rocky mountains', correct: false },
                                { label: 'The rocky Mountains', correct: false }
                            ],
                            rationale: 'Proper geographical names are fully capitalized.',
                            ref: '§4.21'
                        }
                    ]
                },
                publications: {
                    title: 'Publications',
                    questions: [
                        {
                            type: 'mcq',
                            stem: 'How should this title be capitalized: "a guide to plain language"?',
                            options: [
                                { label: 'a guide to plain language', correct: false },
                                { label: 'A Guide to Plain Language', correct: true },
                                { label: 'A Guide To Plain Language', correct: false },
                                { label: 'A GUIDE TO PLAIN LANGUAGE', correct: false }
                            ],
                            rationale: 'In titles, capitalize first/last words and important words, but not short prepositions.',
                            ref: '§4.29'
                        }
                    ]
                },
                headings: {
                    title: 'Headings',
                    questions: [
                        {
                            type: 'mcq',
                            stem: 'What is the preferred heading style for Canadian government documents?',
                            options: [
                                { label: 'ALL CAPS STYLE', correct: false },
                                { label: 'Title Case Style', correct: false },
                                { label: 'Sentence style capitalization', correct: true },
                                { label: 'no capitalization', correct: false }
                            ],
                            rationale: 'Sentence-style capitalization is preferred for most government headings.',
                            ref: '§4.31'
                        }
                    ]
                }
            };
            
            // Initialize quizzes using FIXED API
            for (const section of sections) {
                const quiz = quizData[section.id];
                if (quiz) {
                    const container = document.getElementById(`quiz-${section.id}`);
                    if (container) {
                        // FIXED: Use correct constructor parameters
                        const engine = new QuizEngine(quiz, CHAPTER_ID, section.id);
                        const quizElement = engine.render();
                        container.appendChild(quizElement);
                    }
                }
            }
        }
        
        // Initialize navigation
        function initializeNavigation() {
            document.querySelectorAll('.tab-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const sectionId = link.dataset.section;
                    showSection(sectionId);
                    updateActiveTab(link);
                });
            });
        }
        
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.style.display = 'none';
            });
            
            // Show target section
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.style.display = 'block';
            }
        }
        
        function updateActiveTab(activeLink) {
            document.querySelectorAll('.tab-link').forEach(link => {
                link.classList.remove('active');
            });
            activeLink.classList.add('active');
        }
        
        // Initialize everything
        document.addEventListener('DOMContentLoaded', () => {
            updateProgressBar();
            loadSectionQuizzes();
            initializeNavigation();
            
            if (!window.location.hash) {
                router.navigateTo(CHAPTER_ID, 'introduction');
            }
        });
        
        window.addEventListener('progress-changed', updateProgressBar);
    </script>
</body>
</html>
