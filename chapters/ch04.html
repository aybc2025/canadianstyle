<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chapter 4: Capitalization - The Canadian Style</title>
    <link rel="stylesheet" href="../shared/css/main.css">
    <link rel="stylesheet" href="../shared/css/quiz-styles.css">
</head>
<body>
    <header class="site-header">
        <div class="container">
            <div class="logo-wrapper">
                <img src="../shared/img/maple-logo.svg" alt="Canadian Style Logo" class="logo">
                <h1>The Canadian Style</h1>
            </div>
            <nav class="chapter-nav">
                <a href="../index.html" class="btn btn-secondary">Back to Dashboard</a>
            </nav>
        </div>
    </header>

    <div class="chapter-hero">
        <div class="container">
            <nav class="breadcrumb">
                <a href="../index.html">Home</a> / Chapter 4
            </nav>
            <div class="chapter-meta">
                <div class="chapter-icon">4</div>
                <div class="chapter-info">
                    <h1>Capitalization</h1>
                    <p>Master the rules for proper capitalization in Canadian English</p>
                </div>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="chapterProgress" style="width: 0%"></div>
            </div>
        </div>
    </div>

    <!-- FIXED NAVIGATION - matches quiz data -->
    <nav class="section-tabs" id="sectionNav">
        <div class="container">
            <div class="tabs-list">
                <a href="#introduction" class="tab-link active" data-section="introduction">4.01 Introduction</a>
                <a href="#general-principles" class="tab-link" data-section="general-principles">4.02 General Principles</a>
                <a href="#proper-nouns" class="tab-link" data-section="proper-nouns">4.03 Proper Nouns</a>
                <a href="#titles-positions" class="tab-link" data-section="titles-positions">4.04 Titles & Positions</a>
                <a href="#organizations" class="tab-link" data-section="organizations">4.05 Organizations</a>
                <a href="#academic-subjects" class="tab-link" data-section="academic-subjects">4.06 Academic Subjects</a>
                <a href="#special-cases" class="tab-link" data-section="special-cases">4.07 Special Cases</a>
            </div>
        </div>
    </nav>

    <main class="chapter-content">
        <div class="container">
            <!-- Section 4.01: Introduction -->
            <section class="content-section active" id="introduction">
                <div class="section-header">
                    <h2>4.01 Introduction</h2>
                </div>
                
                <div class="lesson-content">
                    <div class="info-box">
                        <h3>üìè Foundation of Good Writing</h3>
                        <p>Proper capitalization enhances readability and shows attention to detail in professional writing.</p>
                    </div>

                    <h3>Basic Principles</h3>
                    <div class="rule-box">
                        <ul>
                            <li><strong>First words:</strong> Capitalize the first word of sentences</li>
                            <li><strong>Proper nouns:</strong> Names of specific people, places, organizations</li>
                            <li><strong>Titles:</strong> When used with names or in formal contexts</li>
                            <li><strong>Consistency:</strong> Follow the same style throughout your document</li>
                        </ul>
                    </div>
                </div>
                
                <div class="section-footer">
                    <button class="btn btn-primary" onclick="completeSection('introduction')">
                        Mark Complete & Continue
                    </button>
                </div>
            </section>

            <!-- Section 4.02: General Principles -->
            <section class="content-section" id="general-principles">
                <div class="section-header">
                    <h2>4.02 General Principles</h2>
                </div>
                
                <div class="lesson-content">
                    <p>Understanding the fundamental rules of capitalization provides the foundation for all other applications.</p>
                    
                    <div class="rule-box">
                        <h3>Core Capitalization Rules</h3>
                        <ul>
                            <li><strong>Sentence beginnings:</strong> Always capitalize the first word</li>
                            <li><strong>Proper nouns:</strong> Specific names require capitals</li>
                            <li><strong>Common nouns:</strong> Generally lowercase unless they begin sentences</li>
                            <li><strong>Adjectives from proper nouns:</strong> Usually capitalized (Canadian, Shakespearean)</li>
                        </ul>
                    </div>
                    
                    <div class="examples-box">
                        <h4>Basic Examples</h4>
                        <div class="example-item good">
                            <p><strong>‚úì Proper noun:</strong> "We visited Montreal last summer."</p>
                        </div>
                        <div class="example-item good">
                            <p><strong>‚úì Common noun:</strong> "The city was beautiful."</p>
                        </div>
                        <div class="example-item good">
                            <p><strong>‚úì Proper adjective:</strong> "She speaks fluent French."</p>
                        </div>
                    </div>
                </div>
                
                <div class="quiz-panel" id="quiz-general-principles"></div>
                
                <div class="section-footer">
                    <button class="btn btn-primary" onclick="completeSection('general-principles')">
                        Mark Complete & Continue
                    </button>
                </div>
            </section>

            <!-- Section 4.03: Proper Nouns -->
            <section class="content-section" id="proper-nouns">
                <div class="section-header">
                    <h2>4.03 Proper Nouns</h2>
                </div>
                
                <div class="lesson-content">
                    <p>Proper nouns name specific people, places, things, or concepts and are always capitalized.</p>
                    
                    <div class="rule-box">
                        <h3>Types of Proper Nouns</h3>
                        <ul>
                            <li><strong>People:</strong> John Smith, Mary Johnson</li>
                            <li><strong>Places:</strong> Toronto, Lake Ontario, Rocky Mountains</li>
                            <li><strong>Organizations:</strong> Parliament Hill, Royal Canadian Mounted Police</li>
                            <li><strong>Events:</strong> Canada Day, World War II</li>
                            <li><strong>Publications:</strong> The Globe and Mail, Maclean's</li>
                        </ul>
                    </div>
                    
                    <div class="examples-box">
                        <h4>Specific vs. Generic</h4>
                        <div class="example-item good">
                            <p><strong>‚úì Specific:</strong> "The University of Toronto announced..."</p>
                        </div>
                        <div class="example-item good">
                            <p><strong>‚úì Generic:</strong> "Most universities require..."</p>
                        </div>
                    </div>
                </div>
                
                <div class="quiz-panel" id="quiz-proper-nouns"></div>
                
                <div class="section-footer">
                    <button class="btn btn-primary" onclick="completeSection('proper-nouns')">
                        Mark Complete & Continue
                    </button>
                </div>
            </section>

            <!-- Section 4.04: Titles & Positions -->
            <section class="content-section" id="titles-positions">
                <div class="section-header">
                    <h2>4.04 Titles & Positions</h2>
                </div>
                
                <div class="lesson-content">
                    <p>Job titles and positions follow specific capitalization rules based on context and usage.</p>
                    
                    <div class="rule-box">
                        <h3>When to Capitalize Titles</h3>
                        <ul>
                            <li><strong>Before names:</strong> Prime Minister Trudeau, Doctor Smith</li>
                            <li><strong>In formal address:</strong> "Thank you, Mr. President"</li>
                            <li><strong>In signatures:</strong> John Smith, Director of Communications</li>
                        </ul>
                    </div>
                    
                    <div class="rule-box">
                        <h3>When NOT to Capitalize</h3>
                        <ul>
                            <li><strong>After names:</strong> "John Smith, president of the company"</li>
                            <li><strong>Generic reference:</strong> "The minister will attend"</li>
                            <li><strong>Plural forms:</strong> "Both prime ministers agreed"</li>
                        </ul>
                    </div>
                    
                    <div class="examples-box">
                        <h4>Title Examples</h4>
                        <div class="example-item good">
                            <p><strong>‚úì Before name:</strong> "Minister Wilson announced the policy."</p>
                        </div>
                        <div class="example-item good">
                            <p><strong>‚úì After name:</strong> "John Wilson, minister of health"</p>
                        </div>
                        <div class="example-item good">
                            <p><strong>‚úì Generic:</strong> "The minister will attend."</p>
                        </div>
                    </div>
                </div>
                
                <div class="quiz-panel" id="quiz-titles-positions"></div>
                
                <div class="section-footer">
                    <button class="btn btn-primary" onclick="completeSection('titles-positions')">
                        Mark Complete & Continue
                    </button>
                </div>
            </section>

            <!-- Section 4.05: Organizations -->
            <section class="content-section" id="organizations">
                <div class="section-header">
                    <h2>4.05 Organizations</h2>
                </div>
                
                <div class="lesson-content">
                    <p>Capitalize the names of specific organizations, institutions, and government bodies.</p>
                    
                    <div class="rule-box">
                        <h3>Organization Types</h3>
                        <ul>
                            <li><strong>Government Bodies:</strong> House of Commons, Supreme Court of Canada</li>
                            <li><strong>Educational Institutions:</strong> McGill University, Seneca College</li>
                            <li><strong>Companies:</strong> Air Canada, Canadian Tire Corporation</li>
                            <li><strong>Non-profits:</strong> Red Cross, United Way</li>
                        </ul>
                    </div>
                    
                    <div class="examples-box">
                        <h4>Specific vs. Generic References</h4>
                        <div class="example-item good">
                            <p><strong>Specific:</strong> "The University of British Columbia announced..."</p>
                        </div>
                        <div class="example-item good">
                            <p><strong>Generic:</strong> "Most universities require..."</p>
                        </div>
                    </div>
                </div>
                
                <div class="quiz-panel" id="quiz-organizations"></div>
                
                <div class="section-footer">
                    <button class="btn btn-primary" onclick="completeSection('organizations')">
                        Mark Complete & Continue
                    </button>
                </div>
            </section>

            <!-- Section 4.06: Academic Subjects -->
            <section class="content-section" id="academic-subjects">
                <div class="section-header">
                    <h2>4.06 Academic Subjects</h2>
                </div>
                
                <div class="lesson-content">
                    <p>Academic subjects follow specific capitalization rules based on whether they are languages, proper nouns, or general subjects.</p>
                    
                    <div class="rule-box">
                        <h3>Always Capitalize</h3>
                        <ul>
                            <li><strong>Languages:</strong> English, French, Spanish</li>
                            <li><strong>Specific courses:</strong> Biology 101, Introduction to Psychology</li>
                            <li><strong>Proper nouns:</strong> Canadian History, Shakespearean Literature</li>
                        </ul>
                    </div>
                    
                    <div class="rule-box">
                        <h3>Usually Lowercase</h3>
                        <ul>
                            <li><strong>General subjects:</strong> mathematics, science, history</li>
                            <li><strong>Fields of study:</strong> engineering, medicine, law</li>
                            <li><strong>Academic levels:</strong> undergraduate studies, graduate work</li>
                        </ul>
                    </div>
                    
                    <div class="examples-box">
                        <h4>Academic Subject Examples</h4>
                        <div class="example-item good">
                            <p><strong>‚úì Language:</strong> "She teaches French and Spanish."</p>
                        </div>
                        <div class="example-item good">
                            <p><strong>‚úì General subject:</strong> "He studied mathematics and physics."</p>
                        </div>
                        <div class="example-item good">
                            <p><strong>‚úì Specific course:</strong> "Enroll in Chemistry 101."</p>
                        </div>
                    </div>
                </div>
                
                <div class="quiz-panel" id="quiz-academic-subjects"></div>
                
                <div class="section-footer">
                    <button class="btn btn-primary" onclick="completeSection('academic-subjects')">
                        Mark Complete & Continue
                    </button>
                </div>
            </section>

            <!-- Section 4.07: Special Cases -->
            <section class="content-section" id="special-cases">
                <div class="section-header">
                    <h2>4.07 Special Cases</h2>
                </div>
                
                <div class="lesson-content">
                    <p>Certain situations require special attention to capitalization rules, including holidays, directions, and unique circumstances.</p>
                    
                    <div class="rule-box">
                        <h3>Always Capitalize</h3>
                        <ul>
                            <li><strong>Holidays:</strong> Canada Day, Christmas, New Year's Day</li>
                            <li><strong>Historical periods:</strong> Renaissance, Industrial Revolution</li>
                            <li><strong>Awards:</strong> Nobel Prize, Order of Canada</li>
                            <li><strong>Brand names:</strong> Kleenex, Xerox (but not generic use)</li>
                        </ul>
                    </div>
                    
                    <div class="rule-box">
                        <h3>Directional Guidelines</h3>
                        <ul>
                            <li><strong>Regions:</strong> Northern Ontario, the West (when referring to Western Canada)</li>
                            <li><strong>Directions:</strong> head north, travel east (lowercase for simple directions)</li>
                            <li><strong>Streets:</strong> Bay Street, Main Street West</li>
                        </ul>
                    </div>
                    
                    <div class="examples-box">
                        <h4>Special Case Examples</h4>
                        <div class="example-item good">
                            <p><strong>‚úì Holiday:</strong> "We celebrate Victoria Day in May."</p>
                        </div>
                        <div class="example-item good">
                            <p><strong>‚úì Direction:</strong> "Drive north to Thunder Bay."</p>
                        </div>
                        <div class="example-item good">
                            <p><strong>‚úì Region:</strong> "Northern Ontario has vast forests."</p>
                        </div>
                    </div>
                </div>
                
                <div class="quiz-panel" id="quiz-special-cases"></div>
                
                <div class="section-footer">
                    <button class="btn btn-primary" onclick="completeSection('special-cases')">
                        Complete Chapter 4!
                    </button>
                </div>
            </section>
        </div>
    </main>

    <footer class="site-footer">
        <div class="container">
            <p>&copy; 2024 Government of Canada. Based on <em>The Canadian Style</em> (1997 revised edition)</p>
        </div>
    </footer>

    <!-- Include JavaScript modules -->
    <script type="module" src="../shared/js/router.js"></script>
    <script type="module" src="../shared/js/quiz-engine.js"></script>
    <script type="module" src="../shared/js/progress.js"></script>
    <script type="module" src="../shared/js/components.js"></script>

    <script type="module">
        import { getChapterProgress, setProgress } from '../shared/js/progress.js';
        import { QuizEngine } from '../shared/js/quiz-engine.js';
        
        const CHAPTER_ID = 'ch04';
        
        // CORRECTED SECTIONS to match ch04-quiz.json exactly
        const sections = [
            { id: 'introduction', title: '4.01 Introduction', hasQuiz: false },
            { id: 'general-principles', title: '4.02 General Principles', hasQuiz: true },
            { id: 'proper-nouns', title: '4.03 Proper Nouns', hasQuiz: true },
            { id: 'titles-positions', title: '4.04 Titles & Positions', hasQuiz: true },
            { id: 'organizations', title: '4.05 Organizations', hasQuiz: true },
            { id: 'academic-subjects', title: '4.06 Academic Subjects', hasQuiz: true },
            { id: 'special-cases', title: '4.07 Special Cases', hasQuiz: true }
        ];
        
        // Section navigation
        function initSectionNavigation() {
            const tabs = document.querySelectorAll('.tab-link');
            tabs.forEach(tab => {
                tab.addEventListener('click', (e) => {
                    e.preventDefault();
                    const sectionId = tab.getAttribute('data-section');
                    
                    // Update active tab
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    // Show/hide sections
                    const sections = document.querySelectorAll('.content-section');
                    sections.forEach(section => {
                        section.classList.remove('active');
                    });
                    document.getElementById(sectionId).classList.add('active');
                    
                    // Update URL hash
                    window.location.hash = sectionId;
                });
            });
            
            // Handle initial hash
            const hash = window.location.hash.replace('#', '');
            if (hash && document.getElementById(hash)) {
                const tab = document.querySelector(`[data-section="${hash}"]`);
                if (tab) tab.click();
            } else {
                // Default to first section
                tabs[0]?.click();
            }
        }
        
        // Update progress bar
        function updateProgressBar() {
            const chapterProgress = getChapterProgress(CHAPTER_ID);
            const completed = Object.values(chapterProgress).filter(Boolean).length;
            const percentage = Math.round((completed / sections.length) * 100);
            
            const progressBar = document.getElementById('chapterProgress');
            if (progressBar) {
                progressBar.style.width = percentage + '%';
            }
        }
        
        // Mark section as complete
        window.completeSection = function(sectionId) {
            setProgress(CHAPTER_ID, sectionId, true);
            updateProgressBar();
            
            // Navigate to next section
            const currentIndex = sections.findIndex(s => s.id === sectionId);
            if (currentIndex < sections.length - 1) {
                const nextSection = sections[currentIndex + 1];
                // Show next section
                document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
                document.getElementById(nextSection.id).classList.add('active');
                // Update tab
                document.querySelectorAll('.tab-link').forEach(t => t.classList.remove('active'));
                document.querySelector(`[data-section="${nextSection.id}"]`).classList.add('active');
                window.location.hash = nextSection.id;
            } else {
                // Chapter complete
                showCompletionModal();
            }
        };
        
        function showCompletionModal() {
            const modal = document.createElement('div');
            modal.className = 'completion-modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <h3>üéâ Chapter 4 Complete!</h3>
                    <p>Congratulations! You've mastered capitalization rules in Canadian writing.</p>
                    <div class="modal-actions">
                        <button class="btn btn-outline" onclick="this.closest('.completion-modal').remove()">
                            Stay Here
                        </button>
                        <a href="../index.html" class="btn btn-primary">
                            Back to Dashboard
                        </a>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        // FIXED loadSectionQuizzes function
        async function loadSectionQuizzes() {
            try {
                console.log('üîÑ Loading quiz data for ch04...');
                
                const response = await fetch('../data/ch04-quiz.json');
                if (!response.ok) {
                    console.warn('Quiz data not available for chapter 4');
                    return;
                }
                
                const quizData = await response.json();
                console.log('‚úÖ Quiz data loaded:', Object.keys(quizData.sections || {}));
                
                // Initialize quizzes for sections that have them
                sections.forEach(section => {
                    if (section.hasQuiz) {
                        const sectionQuizData = quizData.sections?.[section.id];
                        if (sectionQuizData && sectionQuizData.questions) {
                            const quizContainer = document.getElementById(`quiz-${section.id}`);
                            if (quizContainer) {
                                console.log(`üéØ Loading quiz for: ${section.id}`);
                                const quizEngine = new QuizEngine(sectionQuizData, CHAPTER_ID, section.id);
                                quizEngine.render(quizContainer);
                            } else {
                                console.error(`Quiz container not found: quiz-${section.id}`);
                            }
                        } else {
                            console.warn(`No quiz data for section: ${section.id}`);
                        }
                    }
                });
                
                console.log('‚úÖ Quiz loading complete for ch04');
            } catch (error) {
                console.error('Error loading quiz data:', error);
            }
        }
        
        // Initialize page
        initSectionNavigation();
        updateProgressBar();
        loadSectionQuizzes();
        
        // Handle window beforeunload for quiz warnings
        window.addEventListener('beforeunload', (event) => {
            const activeQuiz = document.querySelector('.quiz-engine-container .quiz-in-progress');
            if (activeQuiz) {
                event.preventDefault();
                event.returnValue = 'You have a quiz in progress. Are you sure you want to leave?';
            }
        });
    </script>
</body>
</html>
