<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chapter 4: Capitalization - The Canadian Style</title>
    <link rel="stylesheet" href="../shared/css/main.css">
    <link rel="stylesheet" href="../shared/css/quiz-styles.css">
</head>
<body>
    <header class="site-header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <h1><a href="../index.html">The Canadian Style</a></h1>
                </div>
                <nav class="main-nav">
                    <a href="../index.html">Home</a>
                    <a href="../about.html">About</a>
                </nav>
            </div>
        </div>
    </header>

    <nav class="chapter-nav">
        <div class="container">
            <div class="chapter-header">
                <h2>Chapter 4: Capitalization</h2>
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="chapterProgress"></div>
                    </div>
                    <span class="progress-text">Progress</span>
                </div>
            </div>
            
            <div class="section-tabs" id="sectionNav">
                <a href="#introduction" class="tab-link active" data-section="introduction">4.01 Introduction</a>
                <a href="#general-principles" class="tab-link" data-section="general-principles">4.02 General Principles</a>
                <a href="#proper-nouns" class="tab-link" data-section="proper-nouns">4.03 Proper Nouns</a>
                <a href="#titles-positions" class="tab-link" data-section="titles-positions">4.04 Titles & Positions</a>
                <a href="#organizations" class="tab-link" data-section="organizations">4.05 Organizations</a>
                <a href="#academic-subjects" class="tab-link" data-section="academic-subjects">4.06 Academic Subjects</a>
                <a href="#special-cases" class="tab-link" data-section="special-cases">4.07 Special Cases</a>
            </div>
        </div>
    </nav>

    <main class="chapter-content">
        <div class="container">
            <!-- Section 4.01: Introduction -->
            <section class="content-section active" id="introduction">
                <div class="section-header">
                    <h2>4.01 Introduction</h2>
                </div>
                
                <div class="lesson-content">
                    <p>Capitalization in Canadian government writing follows specific rules that ensure consistency, respect, and clarity. This chapter covers when and how to capitalize various types of words and phrases.</p>
                    
                    <div class="key-point">
                        <strong>Key Principle:</strong> Capitalize to show respect and distinguish proper nouns, but avoid unnecessary capitalization that can appear pompous.
                    </div>
                </div>
                
                <div class="section-footer">
                    <button class="btn btn-primary" onclick="completeSection('introduction')">
                        Mark Complete & Continue
                    </button>
                </div>
            </section>

            <!-- Section 4.02: General Principles -->
            <section class="content-section" id="general-principles">
                <div class="section-header">
                    <h2>4.02 General Principles</h2>
                </div>
                
                <div class="lesson-content">
                    <p>Follow these fundamental principles when deciding whether to capitalize words in government documents.</p>
                    
                    <div class="rule-box">
                        <h3>Basic Rules</h3>
                        <ul>
                            <li><strong>Proper nouns:</strong> Names of specific people, places, organizations</li>
                            <li><strong>Common nouns:</strong> Generally lowercase unless part of a proper name</li>
                            <li><strong>When in doubt:</strong> Use lowercase rather than unnecessary capitals</li>
                        </ul>
                    </div>
                    
                    <div class="example-box">
                        <h3>Examples</h3>
                        <ul>
                            <li>✅ "The Minister announced..." (specific title)</li>
                            <li>✅ "A minister from Alberta..." (general reference)</li>
                            <li>✅ "Parliament Hill" vs "the hill"</li>
                        </ul>
                    </div>
                </div>
                
                <div class="quiz-panel" id="quiz-general-principles"></div>
                
                <div class="section-footer">
                    <button class="btn btn-primary" onclick="completeSection('general-principles')">
                        Mark Complete & Continue
                    </button>
                </div>
            </section>

            <!-- Section 4.03: Proper Nouns -->
            <section class="content-section" id="proper-nouns">
                <div class="section-header">
                    <h2>4.03 Proper Nouns</h2>
                </div>
                
                <div class="lesson-content">
                    <p>Proper nouns—names of specific people, places, and things—are always capitalized in Canadian writing.</p>
                    
                    <div class="rule-box">
                        <h3>Geographic Names</h3>
                        <ul>
                            <li><strong>Specific locations:</strong> Lake Superior, Rocky Mountains, Prince Edward Island</li>
                            <li><strong>Generic references:</strong> the lake, the mountains, the island</li>
                        </ul>
                    </div>
                    
                    <div class="rule-box">
                        <h3>Personal Names</h3>
                        <ul>
                            <li><strong>Full names:</strong> Jean Chrétien, Margaret Atwood</li>
                            <li><strong>Family relationships:</strong> Mother (when used as name), my mother (when descriptive)</li>
                        </ul>
                    </div>
                </div>
                
                <div class="quiz-panel" id="quiz-proper-nouns"></div>
                
                <div class="section-footer">
                    <button class="btn btn-primary" onclick="completeSection('proper-nouns')">
                        Mark Complete & Continue
                    </button>
                </div>
            </section>

            <!-- Section 4.04: Titles & Positions -->
            <section class="content-section" id="titles-positions">
                <div class="section-header">
                    <h2>4.04 Titles & Positions</h2>
                </div>
                
                <div class="lesson-content">
                    <p>Government titles and positions require careful attention to capitalization rules depending on context and usage.</p>
                    
                    <div class="rule-box">
                        <h3>When to Capitalize Titles</h3>
                        <ul>
                            <li><strong>Before names:</strong> Prime Minister Trudeau, Minister Smith</li>
                            <li><strong>Direct address:</strong> "Thank you, Minister."</li>
                            <li><strong>In formal contexts:</strong> "The Prime Minister announced..."</li>
                        </ul>
                    </div>
                    
                    <div class="rule-box">
                        <h3>When to Use Lowercase</h3>
                        <ul>
                            <li><strong>Generic references:</strong> "The ministers met..."</li>
                            <li><strong>Job descriptions:</strong> "She works as a deputy minister."</li>
                            <li><strong>Former holders:</strong> "the former prime minister"</li>
                        </ul>
                    </div>
                </div>
                
                <div class="quiz-panel" id="quiz-titles-positions"></div>
                
                <div class="section-footer">
                    <button class="btn btn-primary" onclick="completeSection('titles-positions')">
                        Mark Complete & Continue
                    </button>
                </div>
            </section>

            <!-- Section 4.05: Organizations -->
            <section class="content-section" id="organizations">
                <div class="section-header">
                    <h2>4.05 Organizations</h2>
                </div>
                
                <div class="lesson-content">
                    <p>Government departments, agencies, and other organizations follow specific capitalization patterns.</p>
                    
                    <div class="rule-box">
                        <h3>Government Bodies</h3>
                        <ul>
                            <li><strong>Full names:</strong> Department of National Defence, House of Commons</li>
                            <li><strong>Shortened forms:</strong> the Department, the House</li>
                            <li><strong>Generic terms:</strong> the department, the committee</li>
                        </ul>
                    </div>
                    
                    <div class="example-box">
                        <h3>Examples</h3>
                        <ul>
                            <li>✅ "Transport Canada announced..." (full name)</li>
                            <li>✅ "The Department issued guidance..." (shortened)</li>
                            <li>✅ "several departments collaborated..." (generic)</li>
                        </ul>
                    </div>
                </div>
                
                <div class="quiz-panel" id="quiz-organizations"></div>
                
                <div class="section-footer">
                    <button class="btn btn-primary" onclick="completeSection('organizations')">
                        Mark Complete & Continue
                    </button>
                </div>
            </section>

            <!-- Section 4.06: Academic Subjects -->
            <section class="content-section" id="academic-subjects">
                <div class="section-header">
                    <h2>4.06 Academic Subjects</h2>
                </div>
                
                <div class="lesson-content">
                    <p>Academic disciplines, courses, and educational terms have specific capitalization rules.</p>
                    
                    <div class="rule-box">
                        <h3>Subject Areas</h3>
                        <ul>
                            <li><strong>Specific courses:</strong> Introduction to Psychology, Biology 101</li>
                            <li><strong>General subjects:</strong> psychology, biology, mathematics</li>
                            <li><strong>Languages:</strong> French, English, Mandarin (always capitalized)</li>
                        </ul>
                    </div>
                    
                    <div class="rule-box">
                        <h3>Degrees and Titles</h3>
                        <ul>
                            <li><strong>Specific degrees:</strong> Bachelor of Arts, Master of Science</li>
                            <li><strong>General references:</strong> bachelor's degree, master's degree</li>
                        </ul>
                    </div>
                </div>
                
                <div class="quiz-panel" id="quiz-academic-subjects"></div>
                
                <div class="section-footer">
                    <button class="btn btn-primary" onclick="completeSection('academic-subjects')">
                        Mark Complete & Continue
                    </button>
                </div>
            </section>

            <!-- Section 4.07: Special Cases -->
            <section class="content-section" id="special-cases">
                <div class="section-header">
                    <h2>4.07 Special Cases</h2>
                </div>
                
                <div class="lesson-content">
                    <p>Certain situations require special attention to capitalization, including historical periods, laws, and technical terms.</p>
                    
                    <div class="rule-box">
                        <h3>Laws and Documents</h3>
                        <ul>
                            <li><strong>Specific acts:</strong> Privacy Act, Constitution Act</li>
                            <li><strong>Generic references:</strong> the act, federal legislation</li>
                        </ul>
                    </div>
                    
                    <div class="rule-box">
                        <h3>Historical Periods</h3>
                        <ul>
                            <li><strong>Named periods:</strong> the Renaissance, the Great Depression</li>
                            <li><strong>General periods:</strong> the medieval period, the 20th century</li>
                        </ul>
                    </div>
                    
                    <div class="rule-box">
                        <h3>Lists and Series</h3>
                        <ul>
                            <li>Maintain consistency within each list</li>
                            <li>Consider the grammatical structure</li>
                            <li>When in doubt, use sentence case</li>
                        </ul>
                    </div>
                </div>
                
                <div class="quiz-panel" id="quiz-special-cases"></div>
                
                <div class="section-footer">
                    <button class="btn btn-primary" onclick="completeSection('special-cases')">
                        Chapter Complete!
                    </button>
                </div>
            </section>
        </div>
    </main>

    <footer class="site-footer">
        <div class="container">
            <p>&copy; 2024 Government of Canada. Based on <em>The Canadian Style</em> (1997 revised edition)</p>
        </div>
    </footer>

<!-- Include JavaScript -->
<script type="module">
    import { getProgress, setProgress } from '../shared/js/progress.js';
    import { QuizEngine } from '../shared/js/quiz-engine.js';
    import '../shared/js/components.js';
    
    const CHAPTER_ID = 'ch04';
    const sections = [
        { id: 'introduction', title: '4.01 Introduction' },
        { id: 'general-principles', title: '4.02 General Principles' },
        { id: 'proper-nouns', title: '4.03 Proper Nouns' },
        { id: 'titles-positions', title: '4.04 Titles & Positions' },
        { id: 'organizations', title: '4.05 Organizations' },
        { id: 'academic-subjects', title: '4.06 Academic Subjects' },
        { id: 'publications-titles', title: '4.07 Publications & Titles' },
        { id: 'special-cases', title: '4.08 Special Cases' }
    ];
    
    // Initialize section navigation
    function initSectionNavigation() {
        const tabLinks = document.querySelectorAll('.tab-link');
        
        tabLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const sectionId = this.getAttribute('data-section');
                showSection(sectionId);
                updateActiveTab(this);
            });
        });
        
        // Show first section by default
        showSection('introduction');
    }
    
    function showSection(sectionId) {
        // Hide all sections
        document.querySelectorAll('.content-section').forEach(section => {
            section.style.display = 'none';
        });
        
        // Show target section
        const targetSection = document.getElementById(sectionId);
        if (targetSection) {
            targetSection.style.display = 'block';
        }
    }
    
    function updateActiveTab(activeLink) {
        document.querySelectorAll('.tab-link').forEach(link => {
            link.classList.remove('active');
        });
        activeLink.classList.add('active');
    }
    
    // Update progress bar
    function updateProgressBar() {
        const chapterProgress = getProgress(CHAPTER_ID);
        const completed = Object.values(chapterProgress).filter(Boolean).length;
        const total = sections.length;
        const percentage = (completed / total) * 100;
        
        const progressBar = document.getElementById('chapterProgress');
        if (progressBar) {
            progressBar.style.width = `${percentage}%`;
        }
    }
    
    // Complete section function
    window.completeSection = function(sectionId) {
        setProgress(CHAPTER_ID, sectionId, true);
        updateProgressBar();
        
        // Find next section
        const currentIndex = sections.findIndex(s => s.id === sectionId);
        if (currentIndex < sections.length - 1) {
            const nextSection = sections[currentIndex + 1];
            showSection(nextSection.id);
            
            // Update tab
            const nextTab = document.querySelector(`[data-section="${nextSection.id}"]`);
            if (nextTab) {
                updateActiveTab(nextTab);
            }
        }
    };
    
    // Load quiz data and create quizzes
    async function loadSectionQuizzes() {
        try {
            console.log(`Loading quizzes for ${CHAPTER_ID}...`);
            
            const response = await fetch(`../data/${CHAPTER_ID}-quiz.json`);
            if (!response.ok) {
                console.warn(`Quiz data not available for ${CHAPTER_ID}`);
                return;
            }
            
            const quizData = await response.json();
            console.log('Quiz data loaded:', quizData);
            
            // Initialize quizzes for sections that have them
            sections.forEach(section => {
                const sectionQuizData = quizData.sections?.[section.id];
                if (sectionQuizData && sectionQuizData.questions && sectionQuizData.questions.length > 0) {
                    const quizContainer = document.getElementById(`quiz-${section.id}`);
                    if (quizContainer) {
                        console.log(`Creating quiz for ${section.id}`);
                        const quizEngine = new QuizEngine(sectionQuizData, CHAPTER_ID, section.id);
                        quizEngine.render(quizContainer);
                    }
                }
            });
        } catch (error) {
            console.error('Error loading quiz data:', error);
        }
    }
    
    // Show completion modal
    window.showCompletionModal = function() {
        const modal = document.createElement('div');
        modal.className = 'completion-modal-overlay';
        modal.innerHTML = `
            <div class="completion-modal">
                <div class="completion-content">
                    <h2>🎉 Chapter 4 Complete!</h2>
                    <p>Congratulations! You've mastered Canadian capitalization rules.</p>
                    <p>Your documents will now have proper capitalization throughout.</p>
                    <div class="modal-buttons">
                        <button onclick="window.location.href='../index.html'" class="btn btn-primary">
                            Back to Dashboard
                        </button>
                        <button onclick="window.location.href='ch05.html'" class="btn btn-secondary">
                            Next Chapter: Numerical Expressions
                        </button>
                    </div>
                </div>
            </div>
        `;
        
        modal.addEventListener('click', function(e) {
            if (e.target === modal) {
                modal.remove();
            }
        });
        
        document.body.appendChild(modal);
    }
    
    // Initialize everything when DOM is loaded
    document.addEventListener('DOMContentLoaded', function() {
        initSectionNavigation();
        updateProgressBar();
        loadSectionQuizzes();
    });
    
    // Handle page unload warnings for active quizzes
    window.addEventListener('beforeunload', (event) => {
        const activeQuiz = document.querySelector('.quiz-engine-container .quiz-in-progress');
        if (activeQuiz) {
            event.preventDefault();
            event.returnValue = 'Are you sure you want to leave?';
            return event.returnValue;
        }
    });
</script>
</body>
</html>
