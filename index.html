<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Canadian Style - Interactive Learning Guide</title>
    <link rel="stylesheet" href="shared/css/main.css">
</head>
<body>
    <header class="site-header">
        <div class="container">
            <div class="logo-wrapper">
                <img src="shared/img/maple-logo.svg" alt="Canadian Style Logo" class="logo">
                <h1>The Canadian Style</h1>
                <p class="tagline">Interactive Canadian English Style Guide</p>
            </div>
        </div>
    </header>

    <main>
        <!-- Welcome Section -->
        <section class="welcome-section">
            <div class="container">
                <div class="welcome-content">
                    <div class="welcome-text">
                        <h2>Master Canadian Writing Standards</h2>
                        <p>Learn proper Canadian English conventions through interactive lessons, practical exercises, and comprehensive style guidelines. Based on the official government publication.</p>
                        
                        <div class="stats-overview">
                            <div class="stat-item">
                                <span class="stat-number" id="totalProgress">0%</span>
                                <span class="stat-label">Overall Progress</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-number" id="chaptersCompleted">0</span>
                                <span class="stat-label">Chapters Completed</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-number" id="sectionsCompleted">0</span>
                                <span class="stat-label">Sections Completed</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="quick-actions">
                        <a href="chapters/ch01.html" class="btn btn-primary btn-large">
                            ðŸš€ Start Learning
                        </a>
                        <a href="chapters/french-words-appendix.html" class="btn btn-outline btn-large">
                            ðŸ‡«ðŸ‡· French Words Guide
                        </a>
                    </div>
                </div>
            </div>
        </section>

        <!-- Chapter Categories -->
        <section class="categories-section">
            <div class="container">
                <h2 class="section-title">Learning Modules</h2>
                
                <!-- Filter Tabs -->
                <div class="filter-tabs">
                    <button class="filter-btn active" data-filter="all">All Chapters</button>
                    <button class="filter-btn" data-filter="basics">Fundamentals</button>
                    <button class="filter-btn" data-filter="typography">Typography</button>
                    <button class="filter-btn" data-filter="style">Style & Usage</button>
                </div>

                <!-- Chapters Grid -->
                <div class="chapters-grid" id="chaptersGrid">
                    <!-- Chapters will be dynamically generated here -->
                </div>

                <!-- MINIMAL ADDITION: Reference Materials Section -->
                <div class="reference-section">
                    <h3 class="reference-title">ðŸ“š Reference Materials</h3>
                    <div class="appendix-card">
                        <div class="appendix-info">
                            <h4>Appendix A: French Words in English Text</h4>
                            <p>Essential guide for handling French words, phrases, and expressions in Canadian English documents.</p>
                            <ul class="appendix-features">
                                <li>Italicization and formatting rules</li>
                                <li>Accent mark guidelines</li>
                                <li>Decision trees for usage</li>
                                <li>Common examples and patterns</li>
                            </ul>
                        </div>
                        <div class="appendix-action">
                            <a href="chapters/french-words-appendix.html" class="btn btn-primary">
                                Access Appendix A
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="site-footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-info">
                    <h3>The Canadian Style</h3>
                    <p>Based on the official Government of Canada publication, this interactive guide helps you master Canadian English writing conventions.</p>
                </div>
                <div class="footer-links">
                    <h4>Quick Access</h4>
                    <ul>
                        <li><a href="chapters/ch04.html">Capitalization</a></li>
                        <li><a href="chapters/ch16.html">Revision Checklist</a></li>
                        <li><a href="chapters/french-words-appendix.html">French Words Guide</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 Government of Canada. Based on <em>The Canadian Style</em> (1997 revised edition)</p>
            </div>
        </div>
    </footer>

    <script>
        // Chapter configuration - UNCHANGED
        const CHAPTERS_CONFIG = {
            ch01: { number: "1", title: "Abbreviations", description: "Learn proper abbreviation usage and formatting.", category: "basics" },
            ch02: { number: "2", title: "Hyphenation", description: "Master compound words and word division.", category: "basics" },
            ch03: { number: "3", title: "Spelling", description: "Canadian spelling conventions and common errors.", category: "basics" },
            ch04: { number: "4", title: "Capitalization", description: "Rules for proper capitalization in Canadian English.", category: "basics" },
            ch05: { number: "5", title: "Numerical Expressions", description: "Format numbers, dates, and measurements correctly.", category: "basics" },
            ch06: { number: "6", title: "Italics", description: "When and how to use italics effectively.", category: "typography" },
            ch07: { number: "7", title: "Punctuation", description: "Master punctuation marks and their proper usage.", category: "typography" },
            ch08: { number: "8", title: "Quotations", description: "Handle direct and indirect quotations properly.", category: "typography" },
            ch09: { number: "9", title: "Reference Matter", description: "Format footnotes, citations, and bibliographies.", category: "typography" },
            ch10: { number: "10", title: "Letters & Memos", description: "Professional correspondence formats.", category: "typography" },
            ch11: { number: "11", title: "Reports & Minutes", description: "Structure formal documents effectively.", category: "typography" },
            ch12: { number: "12", title: "Usage", description: "Common word usage problems and solutions.", category: "style" },
            ch13: { number: "13", title: "Plain Language", description: "Write clearly and accessibly for all readers.", category: "style" },
            ch14: { number: "14", title: "Bias-Free Language", description: "Use inclusive and respectful language.", category: "style" },
            ch15: { number: "15", title: "Geographical Names", description: "Handle place names and geographical references.", category: "style" },
            ch16: { number: "16", title: "Revision and Proofreading", description: "Perfect your editing and proofreading skills.", category: "style" }
        };

        let currentFilter = 'all';

        // Initialize dashboard - UNCHANGED FUNCTIONALITY
        function initializeDashboard() {
            updateWelcomeStats();
            generateChapterCards();
            setupEventListeners();
        }

        function updateWelcomeStats() {
            try {
                const overallStats = getOverallProgress();
                
                if (overallStats) {
                    document.getElementById('totalProgress').textContent = `${overallStats.overallPercentage || 0}%`;
                    document.getElementById('chaptersCompleted').textContent = overallStats.completedChapters || 0;
                    document.getElementById('sectionsCompleted').textContent = overallStats.completedSections || 0;
                } else {
                    document.getElementById('totalProgress').textContent = '0%';
                    document.getElementById('chaptersCompleted').textContent = '0';
                    document.getElementById('sectionsCompleted').textContent = '0';
                }
            } catch (error) {
                console.error('Error updating welcome stats:', error);
                document.getElementById('totalProgress').textContent = '0%';
                document.getElementById('chaptersCompleted').textContent = '0';
                document.getElementById('sectionsCompleted').textContent = '0';
            }
        }

        function generateChapterCards() {
            const grid = document.getElementById('chaptersGrid');
            if (!grid) return;
            
            try {
                const cards = Object.entries(CHAPTERS_CONFIG).map(([id, config]) => {
                    const progress = getDetailedChapterProgress(id);
                    const percentage = progress && progress.totalSections > 0 ? 
                        Math.round((progress.completedSections / progress.totalSections) * 100) : 0;
                    
                    return `
                        <div class="chapter-card" data-category="${config.category}">
                            <div class="chapter-header">
                                <span class="chapter-number">${config.number}</span>
                                <span class="chapter-category">${config.category}</span>
                            </div>
                            <div class="chapter-content">
                                <h3 class="chapter-title">${config.title}</h3>
                                <p class="chapter-description">${config.description}</p>
                                <div class="chapter-progress">
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: ${percentage}%"></div>
                                    </div>
                                    <span class="progress-text">${percentage}% Complete</span>
                                </div>
                            </div>
                            <div class="chapter-actions">
                                <a href="chapters/${id}.html" class="btn btn-primary btn-small">
                                    Start Chapter
                                </a>
                            </div>
                        </div>
                    `;
                }).join('');
                
                grid.innerHTML = cards;
            } catch (error) {
                console.error('Error generating chapter cards:', error);
                grid.innerHTML = '<p>Error loading chapters. Please refresh the page.</p>';
            }
        }

        function setupEventListeners() {
            const filterTabs = document.querySelectorAll('.filter-btn');
            filterTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const filter = tab.dataset.filter;
                    setActiveFilter(filter);
                    filterChapters(filter);
                });
            });
        }

        function setActiveFilter(filter) {
            const tabs = document.querySelectorAll('.filter-btn');
            tabs.forEach(tab => {
                tab.classList.toggle('active', tab.dataset.filter === filter);
            });
            currentFilter = filter;
        }

        function filterChapters(filter) {
            const cards = document.querySelectorAll('.chapter-card');
            cards.forEach(card => {
                const category = card.dataset.category;
                const shouldShow = filter === 'all' || category === filter;
                card.style.display = shouldShow ? 'block' : 'none';
            });
        }

        // Progress tracking functions - UNCHANGED
        function getOverallProgress() {
            try {
                let totalSections = 0;
                let completedSections = 0;
                let completedChapters = 0;

                Object.keys(CHAPTERS_CONFIG).forEach(chapterId => {
                    const progress = getDetailedChapterProgress(chapterId);
                    if (progress) {
                        totalSections += progress.totalSections;
                        completedSections += progress.completedSections;
                        if (progress.completedSections === progress.totalSections && progress.totalSections > 0) {
                            completedChapters++;
                        }
                    }
                });

                const overallPercentage = totalSections > 0 ? Math.round((completedSections / totalSections) * 100) : 0;

                return {
                    overallPercentage,
                    completedChapters,
                    completedSections,
                    totalSections
                };
            } catch (error) {
                console.error('Error calculating overall progress:', error);
                return { overallPercentage: 0, completedChapters: 0, completedSections: 0, totalSections: 0 };
            }
        }

        function getDetailedChapterProgress(chapterId) {
            try {
                const progress = JSON.parse(localStorage.getItem(`progress_${chapterId}`) || '{}');
                const estimatedSections = 8;
                const completedSections = Object.values(progress).filter(Boolean).length;
                
                return {
                    totalSections: estimatedSections,
                    completedSections: Math.min(completedSections, estimatedSections)
                };
            } catch (error) {
                console.error(`Error getting progress for ${chapterId}:`, error);
                return { totalSections: 8, completedSections: 0 };
            }
        }

        // Initialize dashboard when page loads
        document.addEventListener('DOMContentLoaded', initializeDashboard);
        setInterval(updateWelcomeStats, 5000);
    </script>
</body>
</html>