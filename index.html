<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Canadian Style - Learning Platform</title>
    <link rel="stylesheet" href="shared/css/main.css">
    <link rel="stylesheet" href="shared/css/quiz-styles.css">
</head>
<body>
    <!-- Site Header -->
    <header class="site-header">
        <div class="container">
            <div class="header-content">
                <div class="logo-area">
                    <img src="shared/img/maple-logo.svg" alt="Maple Leaf" class="logo">
                    <h1>The Canadian Style</h1>
                </div>
                
                <!-- Filter Navigation -->
                <nav class="filter-nav">
                    <button class="filter-btn active" data-filter="all">All Subjects</button>
                    <button class="filter-btn" data-filter="typography">Typography & Format</button>
                    <button class="filter-btn" data-filter="style">Style & Usage</button>
                </nav>
            </div>
        </div>
    </header>

    <!-- Main Dashboard -->
    <main class="dashboard">
        <div class="container">
            <!-- Welcome Banner -->
            <section class="welcome-banner">
                <h2>Master Canadian Government Writing Style</h2>
                <p>Interactive lessons based on "The Canadian Style" (1997 revised edition)</p>
                <div class="overall-progress">
                    <div class="overall-stats">
                        <div class="stat">
                            <span class="stat-value" id="overallCompletion">0%</span>
                            <span class="stat-label">Overall Progress</span>
                        </div>
                        <div class="stat">
                            <span class="stat-value" id="completedChapters">0</span>
                            <span class="stat-label">Chapters Completed</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Chapters Grid -->
            <section class="chapters-grid" id="chaptersGrid">
                <!-- Chapter cards will be generated here -->
            </section>
        </div>
    </main>

    <!-- Footer -->
    <footer class="site-footer">
        <div class="container">
            <p>&copy; 2024 Government of Canada. Based on "The Canadian Style" (1997 revised edition).</p>
            <div class="footer-actions">
                <button class="btn btn-secondary" onclick="exportProgress()">Export Progress</button>
                <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importProgress(this)">
                <button class="btn btn-secondary" onclick="document.getElementById('importFile').click()">Import Progress</button>
                <button class="btn btn-outline" onclick="resetProgress()">Reset Progress</button>
            </div>
        </div>
    </footer>

    <!-- Loading Scripts -->
    <script type="module" src="shared/js/progress.js"></script>
    <script type="module" src="shared/js/components.js"></script>
    
    <script type="module">
        // Chapter data with complete information
        const chaptersData = [
            { id: 'ch01', number: '01', title: 'Capitalization', description: 'Rules for using capital letters correctly.', sections: 8, category: 'typography' },
            { id: 'ch02', number: '02', title: 'Compounds', description: 'Forming compound words correctly.', sections: 9, category: 'typography' },
            { id: 'ch03', number: '03', title: 'Hyphens', description: 'Using hyphens in compound words and phrases.', sections: 9, category: 'typography' },
            { id: 'ch04', number: '04', title: 'Abbreviations', description: 'Standard abbreviations and acronyms.', sections: 10, category: 'typography' },
            { id: 'ch05', number: '05', title: 'Numbers', description: 'Numerical expressions in government writing.', sections: 9, category: 'typography' },
            { id: 'ch06', number: '06', title: 'Italics', description: 'When and how to use italic formatting.', sections: 8, category: 'typography' },
            { id: 'ch07', number: '07', title: 'Punctuation', description: 'Complete guide to punctuation marks.', sections: 10, category: 'typography' },
            { id: 'ch08', number: '08', title: 'Quotations', description: 'Quotations and quotation marks.', sections: 7, category: 'typography' },
            { id: 'ch09', number: '09', title: 'Reference Matter', description: 'Bibliographies, footnotes, and citations.', sections: 6, category: 'typography' },
            { id: 'ch10', number: '10', title: 'Letters', description: 'Letters and memorandums format.', sections: 8, category: 'typography' },
            { id: 'ch11', number: '11', title: 'Reports', description: 'Reports and minutes structure.', sections: 7, category: 'typography' },
            { id: 'ch12', number: '12', title: 'Usage', description: 'Common usage issues and solutions.', sections: 3, category: 'style' },
            { id: 'ch13', number: '13', title: 'Plain Language', description: 'Writing clearly and simply.', sections: 7, category: 'style' },
            { id: 'ch14', number: '14', title: 'Bias-Free Writing', description: 'Elimination of stereotyping in writing.', sections: 4, category: 'style' },
            { id: 'ch15', number: '15', title: 'Geographical Names', description: 'Canadian geographical naming conventions.', sections: 5, category: 'style' },
            { id: 'ch16', number: '16', title: 'Revision', description: 'Revision and proofreading techniques.', sections: 7, category: 'style' }
        ];

        // Initialize dashboard
        function initializeDashboard() {
            renderChapterCards();
            updateOverallProgress();
            setupFilterButtons();
        }

        // Render chapter cards
        function renderChapterCards() {
            const grid = document.getElementById('chaptersGrid');
            grid.innerHTML = '';

            chaptersData.forEach(chapter => {
                const completion = window.calculateChapterProgress ? window.calculateChapterProgress(chapter.id) : 0;
                const ctaText = completion > 0 ? 'Continue' : 'Start';
                
                const card = document.createElement('cs-card');
                card.setAttribute('chapter-id', chapter.id);
                card.setAttribute('chapter-number', chapter.number);
                card.setAttribute('title', chapter.title);
                card.setAttribute('percentage', completion);
                card.setAttribute('sections-count', chapter.sections);
                card.setAttribute('href', `chapters/${chapter.id}.html`);
                card.setAttribute('cta-text', ctaText);
                card.setAttribute('category', chapter.category);
                
                // Add description
                card.innerHTML = `<p class="card-description">${chapter.description}</p>`;
                
                grid.appendChild(card);
            });
        }

        // Update overall progress
        function updateOverallProgress() {
            let totalSections = 0;
            let completedSections = 0;
            let completedChapters = 0;

            chaptersData.forEach(chapter => {
                totalSections += chapter.sections;
                const progress = window.getChapterProgress ? window.getChapterProgress(chapter.id) : {};
                const completed = Object.values(progress).filter(Boolean).length;
                completedSections += completed;
                
                if (completed === chapter.sections) {
                    completedChapters++;
                }
            });

            const overallCompletion = totalSections > 0 ? Math.round((completedSections / totalSections) * 100) : 0;
            
            document.getElementById('overallCompletion').textContent = `${overallCompletion}%`;
            document.getElementById('completedChapters').textContent = `${completedChapters}/16`;
        }

        // Setup filter buttons
        function setupFilterButtons() {
            const filterBtns = document.querySelectorAll('.filter-btn');
            const cards = document.querySelectorAll('cs-card');

            filterBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    // Update active state
                    filterBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');

                    const filter = btn.dataset.filter;
                    
                    // Filter cards
                    cards.forEach(card => {
                        const category = card.getAttribute('category');
                        if (filter === 'all' || category === filter) {
                            card.style.display = 'block';
                        } else {
                            card.style.display = 'none';
                        }
                    });
                });
            });
        }

        // Export progress
        window.exportProgress = function() {
            if (window.exportProgress) {
                window.exportProgress();
            } else {
                alert('Export feature not available. Please ensure progress.js is loaded correctly.');
            }
        };

        // Import progress
        window.importProgress = async function(input) {
            if (input.files && input.files[0]) {
                try {
                    if (window.importProgress) {
                        await window.importProgress(input.files[0]);
                        renderChapterCards();
                        updateOverallProgress();
                        alert('Progress imported successfully!');
                    }
                } catch (error) {
                    alert('Error importing progress: ' + error.message);
                }
            }
        };

        // Reset progress
        window.resetProgress = function() {
            if (confirm('Are you sure you want to reset all progress? This cannot be undone.')) {
                if (window.clearProgress) {
                    window.clearProgress();
                    renderChapterCards();
                    updateOverallProgress();
                }
            }
        };

        // Listen for progress changes
        window.addEventListener('progress-changed', () => {
            renderChapterCards();
            updateOverallProgress();
        });

        window.addEventListener('progress-cleared', () => {
            renderChapterCards();
            updateOverallProgress();
        });

        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', initializeDashboard);
    </script>
</body>
</html>
